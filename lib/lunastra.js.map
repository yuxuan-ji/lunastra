{"version":3,"sources":["webpack://Lunastra/webpack/universalModuleDefinition","webpack://Lunastra/webpack/bootstrap","webpack://Lunastra/./src/core/configuration.js","webpack://Lunastra/./src/core/document_store.js","webpack://Lunastra/./src/core/inverted_index.js","webpack://Lunastra/./src/core/pipeline.js","webpack://Lunastra/./src/core/tokenizer.js","webpack://Lunastra/./src/events/event_emitter.js","webpack://Lunastra/./src/exts/stemmer.js","webpack://Lunastra/./src/exts/stop_word_filters.js","webpack://Lunastra/./src/exts/trimmer.js","webpack://Lunastra/./src/index.js","webpack://Lunastra/./src/lunastra.js","webpack://Lunastra/./src/utils/utils.js"],"names":["Configuration","config","fields","undefined","Error","userConfig","length","buildDefaultConfig","JSON","parse","buildUserConfig","error","reset","forEach","field","boost","bool","expand","globalBool","globalExpand","indexOf","fieldConfig","fieldExpand","addAllFieldsToUserConfig","DocumentStore","save","deepcpy","_save","_deepcpy","docs","docInfo","id","hasDoc","doc","fieldName","addFieldLength","InvertedIndex","root","df","token","tokenInfo","i","key","tf","node","getNode","memo","push","expandToken","Pipeline","_queue","fs","f","existingFct","newFct","pos","splice","pop","input","Array","isArray","output","ext","pipelineOutput","item","extensionOutput","run","el","Tokenizer","str","arguments","arr","filter","map","t","toLowerCase","out","tokens","split","separator","concat","toString","trim","sep","defaultSeparator","EventEmitter","events","event","args","TypeError","hasHandler","fIndex","apply","Stemmer","word","step2list","step3list","c","v","C","V","mgr0","meq1","mgr1","s_v","re_mgr0","RegExp","re_mgr1","re_meq1","re_s_v","re_1a","re2_1a","re_1b","re2_1b","re_1b_2","re2_1b_2","re3_1b_2","re4_1b_2","re_1c","re_2","re_3","re_4","re2_4","re_5","re_5_1","re3_5","porterStemmer","w","stem","suffix","firstch","re","re2","re3","re4","fp","substr","toUpperCase","test","replace","exec","StopWordFilter","stopWords","words","defaultStopWords","Trimmer","Index","_fields","_id","_idfCache","index","pipeline","documentStore","eventEmitter","on","bind","slice","addListener","fn","removeListener","emitEvent","addDoc","fieldTokens","tokenize","tokenCount","termFrequency","Math","sqrt","addToken","emit","isDocStored","getDoc","removeDoc","removeToken","removeDocById","query","any","stringify","configStr","getFields","get","queryTokens","queryFields","Object","keys","queryResults","fieldSearchResults","fieldSearch","fieldBoost","results","result","score","sort","a","b","booleanType","scores","docTokens","queryTokenScores","getDocs","idf","filteredDocs","fieldSearchStats","getTermFrequency","fieldLength","getFieldLength","fieldLengthNorm","penality","mergeScores","coordNorm","accumScores","op","intersection","term","cacheKey","prototype","hasOwnProperty","call","getDocFreq","log","n","init","add","warn","global","message","console","obj","clone","copy","constructor","attr"],"mappings":"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","file":"Lunastra.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Lunastra\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Lunastra\"] = factory();\n\telse\n\t\troot[\"Lunastra\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/lunastra.js\");\n","import {warn} from '../utils/utils.js';\r\n\r\n/**\r\n * A wrapper on a user search configuration.\r\n */\r\nexport class Configuration {\r\n\r\n  /**\r\n   * Initialize a configuration\r\n   * @param  {string} config\r\n   * @param  {string[]} fields\r\n   */\r\n  constructor(config, fields) {\r\n    config = config || '';\r\n\r\n    if (fields === undefined || fields == null) {\r\n      throw new Error('fields should not be null');\r\n    }\r\n\r\n    this.config = {};\r\n\r\n    var userConfig;\r\n    if (config.length === 0) {\r\n      this.buildDefaultConfig(fields);\r\n    } else {\r\n      try {\r\n        userConfig = JSON.parse(config);\r\n        this.buildUserConfig(userConfig, fields);\r\n      } catch (error) {\r\n        warn('user configuration parse failed, will use default configuration');\r\n        this.buildDefaultConfig(fields);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user config\r\n   * @return {JSON}\r\n   */\r\n  get() {\r\n    return this.config;\r\n  }\r\n\r\n  /**\r\n   * Reset user search configuration\r\n   */\r\n  reset() {\r\n    this.config = {};\r\n  }\r\n\r\n  /**\r\n   * Build default search configuration\r\n   * @private\r\n   * @param  {string[]} fields\r\n   */\r\n  buildDefaultConfig(fields) {\r\n    this.reset();\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: \"OR\",\r\n        expand: false\r\n      };\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Build user search configuration\r\n   * @private\r\n   * @param  {JSON} config\r\n   * @param  {string[]} fields\r\n   */\r\n  buildUserConfig(config, fields) {\r\n    var globalBool = \"OR\";\r\n    var globalExpand = false;\r\n\r\n    this.reset();\r\n    if ('bool' in config) {\r\n      globalBool = config['bool'] || globalBool;\r\n    }\r\n\r\n    if ('expand' in config) {\r\n      globalExpand = config['expand'] || globalExpand;\r\n    }\r\n\r\n    if ('fields' in config) {\r\n      for (var field in config['fields']) {\r\n        if (fields.indexOf(field) > -1) {\r\n          var fieldConfig = config['fields'][field];\r\n          var fieldExpand = globalExpand;\r\n          if (fieldConfig.expand != null) {\r\n            fieldExpand = fieldConfig.expand;\r\n          }\r\n\r\n          this.config[field] = {\r\n            boost: (fieldConfig.boost || fieldConfig.boost === 0) ? fieldConfig.boost : 1,\r\n            bool: fieldConfig.bool || globalBool,\r\n            expand: fieldExpand\r\n          };\r\n        } else {\r\n          warn('field name in user configuration not found in index instance fields');\r\n        }\r\n      }\r\n    } else {\r\n      this.addAllFieldsToUserConfig(globalBool, globalExpand, fields);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a fields to user search configuration\r\n   * @param {string} bool   Boolean model\r\n   * @param {string} expand Expand model\r\n   * @param {string[]} fields fields of the index instance\r\n   */\r\n  addAllFieldsToUserConfig(bool, expand, fields) {\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: bool,\r\n        expand: expand\r\n      };\r\n    }, this);\r\n  }\r\n\r\n}\r\n","import {clone} from '../utils/utils.js';\r\n\r\n/**\r\n * A key-value document store used for storing sets of tokens for\r\n * documents stored in the index.\r\n */\r\nexport class DocumentStore {\r\n\r\n  /**\r\n   * Initialize a document store\r\n   * @param  {boolean} save    whether to store original documents\r\n   * @param  {boolean} deepcpy whether to deep copy the original documents\r\n   */\r\n  constructor(save = true, deepcpy = true) {\r\n    this._save = (save !== false);\r\n    this._deepcpy = (deepcpy !== false);\r\n    this.docs = {};\r\n    this.docInfo = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  get deepcpy() {return this._deepcpy;}\r\n\r\n  isDocStored() {return this._save;}\r\n\r\n  /**\r\n   * Check whether a given document id is stored\r\n   * @param  {string|number}  id\r\n   * @return {boolean}\r\n   */\r\n  hasDoc(id) {\r\n    return id in this.docs;\r\n  }\r\n\r\n  /**\r\n   * Get a document by its id\r\n   * @param  {string|number} id\r\n   * @return {object}\r\n   */\r\n  getDoc(id) {\r\n    if (this.hasDoc(id) === false) return null;\r\n    return this.docs[id];\r\n  }\r\n\r\n  /**\r\n   * Store a document or update it if it already exists\r\n   * @param {string|number} id\r\n   * @param {object} doc\r\n   */\r\n  addDoc(id, doc) {\r\n    if (!this.hasDoc(id)) this.length++;\r\n\r\n    this.docs[id] = this._save ? (this.deepcpy ? clone(doc) : doc) : null;\r\n\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the store by its id\r\n   * @param  {string|number} id\r\n   */\r\n  removeDoc(id) {\r\n    if (!this.hasDoc(id)) return;\r\n\r\n    delete this.docs[id];\r\n    delete this.docInfo[id];\r\n    this.length--;\r\n  }\r\n\r\n  /**\r\n   * Get the field length of a document by its id\r\n   *\r\n   * @param {number|string} id document id\r\n   * @param {string} fieldName field name\r\n   * @return {number} field length\r\n   */\r\n  getFieldLength(id, fieldName) {\r\n    if (id === null || id === undefined) return 0;\r\n\r\n    if (!(id in this.docs)) return 0;\r\n    if (!(fieldName in this.docInfo[id])) return 0;\r\n    return this.docInfo[id][fieldName];\r\n  };\r\n\r\n  /**\r\n   * Add field length of a document's field tokens from pipeline results.\r\n   * The field length of a document is used to do field length normalization\r\n   * even without the original JSON document stored.\r\n   * @param {number|string} id document's id\r\n   * @param {string} fieldName field name\r\n   * @param {number} length field length\r\n   */\r\n  addFieldLength(id, fieldName, length) {\r\n    if (id === null || id === undefined) return;\r\n    if (!this.hasDoc(id)) return;\r\n\r\n    if (!this.docInfo[id]) this.docInfo[id] = {};\r\n    this.docInfo[id][fieldName] = length;\r\n  }\r\n\r\n  /**\r\n   * Update field length of a document's field tokens from pipeline results.\r\n   * The field length of a document is used to do field length normalization\r\n   * even without the original JSON document stored.\r\n   * @param {number|string} id document's id\r\n   * @param {string} fieldName field name\r\n   * @param {number} length field length\r\n   */\r\n  updateFieldLength(id, fieldName, length) {\r\n    if (id === null || id === undefined) return;\r\n    if (!this.hasDoc(id)) return;\r\n\r\n    this.addFieldLength(id, fieldName, length);\r\n  }\r\n}\r\n","/**\r\n * The entity on which queries are executed upon.\r\n */\r\nexport class InvertedIndex {\r\n\r\n  /**\r\n   * Initialize an inverted index\r\n   */\r\n  constructor() {\r\n    this.root = { docs: {}, df: 0};\r\n  }\r\n\r\n  /**\r\n     * Adds a {token: tokenInfo} pair to the inverted index.\r\n     * If the token already exist, then update the tokenInfo.\r\n     *\r\n     * tokenInfo format: { id: 1, tf: 2}\r\n     * tokenInfo should contains the document's id and the tf(token frequency) of that token in\r\n     * the document.\r\n     *\r\n     * By default this function starts at the root of the current inverted index, however\r\n     * it can start at any node of the inverted index if required.\r\n     *\r\n     * @param {string} token\r\n     * @param {object} tokenInfo format: { id: 1, tf: 2}\r\n     * @param {object} root An optional node at which to start looking for the\r\n     * correct place to enter the doc, by default the root of this InvertedIndex\r\n     * is used.\r\n   */\r\n  addToken(token, tokenInfo, root) {\r\n    root = root || this.root;\r\n\r\n    for (var i = 0; i < token.length; ++i) {\r\n      var key = token[i];\r\n\r\n      if (!(key in root)) root[key] = {docs: {}, df: 0};\r\n      root = root[key];\r\n    }\r\n\r\n    var id = tokenInfo.id;\r\n    if (!root.docs[id]) {\r\n      // if this doc not exist, then add this doc\r\n      root.docs[id] = {tf: tokenInfo.tf};\r\n      root.df += 1;\r\n    } else {\r\n      // if this doc already exist, then update tokenInfo\r\n      root.docs[id] = {tf: tokenInfo.tf};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check whether the token is stored in this inverted index\r\n   * @param  {string}  token\r\n   * @return {boolean}\r\n   */\r\n  hasToken(token) {\r\n    if (!token) return false;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return false;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get a node from the inverted index for a given token.\r\n   * If token not found in this InvertedIndex, return null.\r\n   * @param {string} token The token to get the node for.\r\n   * @return {object}\r\n   */\r\n  getNode(token) {\r\n    if (!token) return null;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return null;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Get the documents of a given token.\r\n   * If token not found, return {}.\r\n   * @param {string} token The token to get the documents for.\r\n   * @return {object}\r\n   */\r\n  getDocs(token) {\r\n    var node = this.getNode(token);\r\n    if (node == null) {\r\n      return {};\r\n    }\r\n\r\n    return node.docs;\r\n  }\r\n\r\n  /**\r\n   * Get term frequency of given token in given document unique id.\r\n   * If token or document id not found, return 0.\r\n   * @param {string} token the token to get the documents for\r\n   * @param {string|number} id the unique id of the document\r\n   * @return {number}\r\n   */\r\n  getTermFrequency(token, id) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    if (!(id in node.docs)) {\r\n      return 0;\r\n    }\r\n\r\n    return node.docs[id].tf;\r\n  }\r\n\r\n  /**\r\n   * Get the document frequency of given token.\r\n   * If token not found, return 0.\r\n   * @param {string} token the token to get the documents for\r\n   * @return {object}\r\n   */\r\n  getDocFreq(token) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    return node.df;\r\n  }\r\n\r\n  /**\r\n   * Remove the document identified by document's id from the token in the inverted index.\r\n   * @param {string} token remove the document from token\r\n   * @param {string} id the id of the document to remove from given token\r\n   */\r\n  removeToken(token, id) {\r\n    if (!token) return;\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) return;\r\n\r\n    if (id in node.docs) {\r\n      delete node.docs[id];\r\n      node.df -= 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find all the possible suffixes of given token using tokens currently in the inverted index.\r\n   * If token not found, return empty Array.\r\n   * @param {string} token the token to expand\r\n   * @return {string[]}\r\n   */\r\n  expandToken(token, memo, root) {\r\n    if (token == null || token === '') return [];\r\n    memo = memo || [];\r\n\r\n    if (root == null) {\r\n      root = this.getNode(token);\r\n      if (root == null) return memo;\r\n    }\r\n\r\n    if (root.df > 0) memo.push(token);\r\n\r\n    for (var key in root) {\r\n      if (key === 'docs') continue;\r\n      if (key === 'df') continue;\r\n      this.expandToken(token + key, memo, root[key]);\r\n    }\r\n\r\n    return memo;\r\n  }\r\n\r\n}\r\n","/**\r\n * An ordered list of functions applied to both document\r\n * tokens and query tokens.\r\n */\r\nexport class Pipeline {\r\n\r\n  /**\r\n   * Initialize a pipeline\r\n   */\r\n  constructor() {\r\n    this._queue = [];\r\n  }\r\n\r\n  /**\r\n   * Return the stored list of functions\r\n   * @return {function[]}\r\n   */\r\n  get() {\r\n    return this._queue;\r\n  }\r\n\r\n  /**\r\n   * Push functions to the end of the pipeline\r\n   * @param {...function} fs\r\n   */\r\n  add(...fs) {\r\n    fs.forEach(function (f) {\r\n      this._queue.push(f);\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Insert a function after a function present in the pipeline\r\n   * @param  {function} existingFct\r\n   * @param  {function} newFct\r\n   */\r\n  after(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos + 1, 0, newFct);\r\n  };\r\n\r\n  /**\r\n   * Insert a function before a function present in the pipeline\r\n   * @param  {function} existingFct\r\n   * @param  {function} newFct\r\n   */\r\n  before(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos, 0, newFct);\r\n  };\r\n\r\n  /**\r\n   * Remove a function from the pipeline\r\n   * @param  {function} f\r\n   */\r\n  remove(f) {\r\n    var pos = this._queue.indexOf(f);\r\n    if (pos === -1) return;\r\n\r\n    this._queue.splice(pos, 1);\r\n  };\r\n\r\n  /**\r\n   * Remove and return the last function in the pipeline\r\n   * @return {function}\r\n   */\r\n  pop() {\r\n    return this._queue.pop();\r\n  }\r\n\r\n  /**\r\n   * Empty the pipeline\r\n   */\r\n  clear() {\r\n    this._queue = [];\r\n  }\r\n\r\n  /**\r\n   * Run each function stored in the pipeline on some input\r\n   * in FIFO order and returns the result in a list\r\n   * @param  {any|any[]} input\r\n   * @return {any[]}\r\n   */\r\n  run(input) {\r\n    if (!Array.isArray(input)) input = [input];\r\n    var output = input;\r\n\r\n    // Apply each pipeline extension on each element of the input\r\n    // and aggregate the result\r\n    this._queue.forEach(function (ext) {\r\n      var pipelineOutput = [];\r\n\r\n      output.forEach(function (item) {\r\n        var extensionOutput = ext.run(item);\r\n        if (!Array.isArray(extensionOutput)) extensionOutput = [extensionOutput];\r\n\r\n        extensionOutput.forEach(function (el) {\r\n          if (el !== null && el !== undefined && el !== \"\") pipelineOutput.push(el);\r\n        });\r\n\r\n      });\r\n      output = pipelineOutput;\r\n\r\n    });\r\n\r\n    return output;\r\n  }\r\n}\r\n","import {toString} from '../utils/utils.js';\r\n\r\n/**\r\n * A wrapper around how Lunastra tokenizes strings\r\n */\r\nexport class Tokenizer {\r\n\r\n  /**\r\n   * Split a string into a list of tokens\r\n   * @param  {string} str\r\n   * @return {string[]}\r\n   */\r\n  static tokenize(str) {\r\n    if (!arguments.length || str === null || str === undefined) return [];\r\n    if (Array.isArray(str)) {\r\n      var arr = str.filter(function (token) {return token !== null && token !== undefined;});\r\n\r\n      arr = arr.map(function (t) {\r\n        return toString(t).toLowerCase();\r\n      });\r\n\r\n      var out = [];\r\n      arr.forEach(function (item) {\r\n        var tokens = item.split(Tokenizer.separator);\r\n        out = out.concat(tokens);\r\n      }, this);\r\n\r\n      return out;\r\n    }\r\n\r\n    return str.toString().trim().toLowerCase().split(Tokenizer.separator);\r\n  }\r\n\r\n  /**\r\n   * Get the seperator\r\n   * @return {string|regexp}\r\n   */\r\n  static getSeparator() {\r\n    return Tokenizer.separator;\r\n  }\r\n\r\n  /**\r\n   * Set the seperator\r\n   * @param {string|regexp} sep\r\n   */\r\n  static setSeparator(sep) {\r\n    Tokenizer.separator = sep;\r\n  }\r\n\r\n  /**\r\n   * Reset to the default seperator\r\n   */\r\n  static resetSeparator() {\r\n    Tokenizer.separator = Tokenizer.defaultSeparator;\r\n  }\r\n\r\n}\r\n\r\nTokenizer.defaultSeparator = /[\\s\\-]+/;\r\nTokenizer.separator = Tokenizer.defaultSeparator;\r\n","/**\r\n * An event manager for Lunastra.\r\n */\r\nexport class EventEmitter {\r\n\r\n  /**\r\n   * Initialize an event emitter\r\n   */\r\n  constructor() {\r\n    this.events = {};\r\n  }\r\n\r\n  /**\r\n   * Check whether an event is registered\r\n   * @private\r\n   * @param {string} event\r\n   * @return {boolean}\r\n   */\r\n  hasHandler(event) {\r\n    return event in this.events;\r\n  };\r\n\r\n  /**\r\n   * Bind a handler function to a specific event(s).\r\n   *\r\n   * Can bind a single function to many different events in one call.\r\n   *\r\n   * @param {string} events the name(s) of events to bind this function to\r\n   * @param {function} f the function to call when an event is fired\r\n   */\r\n  addListener(...args) {\r\n    var f = args.pop();\r\n    var events = args;\r\n\r\n    if (typeof f !== \"function\") throw new TypeError(\"Last argument must be a function\");\r\n\r\n    events.forEach(function (event) {\r\n      if (!this.hasHandler(event)) this.events[event] = [];\r\n      this.events[event].push(f);\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Unbind a handler from an event\r\n   * @param  {string} event\r\n   * @param  {function} f\r\n   */\r\n  removeListener(event, f) {\r\n    if (!this.hasHandler(event)) return;\r\n\r\n    var fIndex = this.events[event].indexOf(f);\r\n    if (fIndex === -1) return;\r\n\r\n    this.events[event].splice(fIndex, 1);\r\n\r\n    if (this.events[event].length === 0) delete this.events[event];\r\n  }\r\n\r\n  /**\r\n   * Emit an event\r\n   * @param  {string} event the event to emit\r\n   * @param {...any} args additional data that the event should expose\r\n   */\r\n  emit(event, ...args) {\r\n    if (!this.hasHandler(event)) return;\r\n\r\n    this.events[event].forEach(function (f) {\r\n      f.apply(undefined, args);\r\n    }, this);\r\n  }\r\n}\r\n","/* eslint camelcase: 0 */\r\n/* eslint max-len: 0 */\r\n/* eslint brace-style: 0 */\r\n\r\n/**\r\n * Pipeline Extension: Stemmer\r\n */\r\nexport class Stemmer {\r\n\r\n  /**\r\n   * Reduce a word to its root and return the result\r\n   * (implementation of the PorterStemmer taken from http://tartarus.org/~martin)\r\n   * @param  {string} word\r\n   * @return {string}\r\n   */\r\n  static run(word) {\r\n    var step2list = {\r\n        \"ational\": \"ate\",\r\n        \"tional\": \"tion\",\r\n        \"enci\": \"ence\",\r\n        \"anci\": \"ance\",\r\n        \"izer\": \"ize\",\r\n        \"bli\": \"ble\",\r\n        \"alli\": \"al\",\r\n        \"entli\": \"ent\",\r\n        \"eli\": \"e\",\r\n        \"ousli\": \"ous\",\r\n        \"ization\": \"ize\",\r\n        \"ation\": \"ate\",\r\n        \"ator\": \"ate\",\r\n        \"alism\": \"al\",\r\n        \"iveness\": \"ive\",\r\n        \"fulness\": \"ful\",\r\n        \"ousness\": \"ous\",\r\n        \"aliti\": \"al\",\r\n        \"iviti\": \"ive\",\r\n        \"biliti\": \"ble\",\r\n        \"logi\": \"log\"\r\n      },\r\n\r\n      step3list = {\r\n        \"icate\": \"ic\",\r\n        \"ative\": \"\",\r\n        \"alize\": \"al\",\r\n        \"iciti\": \"ic\",\r\n        \"ical\": \"ic\",\r\n        \"ful\": \"\",\r\n        \"ness\": \"\"\r\n      },\r\n\r\n      c = \"[^aeiou]\", // consonant\r\n      v = \"[aeiouy]\", // vowel\r\n      C = c + \"[^aeiouy]*\", // consonant sequence\r\n      V = v + \"[aeiou]*\", // vowel sequence\r\n\r\n      mgr0 = \"^(\" + C + \")?\" + V + C, // [C]VC... is m>0\r\n      meq1 = \"^(\" + C + \")?\" + V + C + \"(\" + V + \")?$\", // [C]VC[V] is m=1\r\n      mgr1 = \"^(\" + C + \")?\" + V + C + V + C, // [C]VCVC... is m>1\r\n      s_v = \"^(\" + C + \")?\" + v; // vowel in stem\r\n\r\n    var re_mgr0 = new RegExp(mgr0);\r\n    var re_mgr1 = new RegExp(mgr1);\r\n    var re_meq1 = new RegExp(meq1);\r\n    var re_s_v = new RegExp(s_v);\r\n\r\n    var re_1a = /^(.+?)(ss|i)es$/;\r\n    var re2_1a = /^(.+?)([^s])s$/;\r\n    var re_1b = /^(.+?)eed$/;\r\n    var re2_1b = /^(.+?)(ed|ing)$/;\r\n    var re_1b_2 = /.$/;\r\n    var re2_1b_2 = /(at|bl|iz)$/;\r\n    var re3_1b_2 = new RegExp(\"([^aeiouylsz])\\\\1$\");\r\n    var re4_1b_2 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    var re_1c = /^(.+?[^aeiou])y$/;\r\n    var re_2 = /^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;\r\n\r\n    var re_3 = /^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;\r\n\r\n    var re_4 = /^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;\r\n    var re2_4 = /^(.+?)(s|t)(ion)$/;\r\n\r\n    var re_5 = /^(.+?)e$/;\r\n    var re_5_1 = /ll$/;\r\n    var re3_5 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    function porterStemmer(w) {\r\n      var stem,\r\n        suffix,\r\n        firstch,\r\n        re,\r\n        re2,\r\n        re3,\r\n        re4,\r\n        fp;\r\n\r\n      if (w.length < 3) { return w; }\r\n\r\n      firstch = w.substr(0, 1);\r\n      if (firstch === \"y\") {\r\n        w = firstch.toUpperCase() + w.substr(1);\r\n      }\r\n\r\n      // Step 1a\r\n      re = re_1a;\r\n      re2 = re2_1a;\r\n\r\n      if (re.test(w)) {w = w.replace(re, \"$1$2\");}\r\n      else if (re2.test(w)) {w = w.replace(re2, \"$1$2\");}\r\n\r\n      // Step 1b\r\n      re = re_1b;\r\n      re2 = re2_1b;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        re = re_mgr0;\r\n        if (re.test(fp[1])) {\r\n          re = re_1b_2;\r\n          w = w.replace(re, \"\");\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1];\r\n        re2 = re_s_v;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n          re2 = re2_1b_2;\r\n          re3 = re3_1b_2;\r\n          re4 = re4_1b_2;\r\n          if (re2.test(w)) { w = w + \"e\"; }\r\n          else if (re3.test(w)) { re = re_1b_2; w = w.replace(re, \"\"); }\r\n          else if (re4.test(w)) { w = w + \"e\"; }\r\n        }\r\n      }\r\n\r\n      // Step 1c - replace suffix y or Y by i if preceded by a non-vowel which is\r\n      // not the first letter of the word (so cry -> cri, by -> by, say -> say)\r\n      re = re_1c;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        w = stem + \"i\";\r\n      }\r\n\r\n      // Step 2\r\n      re = re_2;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step2list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 3\r\n      re = re_3;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step3list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 4\r\n      re = re_4;\r\n      re2 = re2_4;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        if (re.test(stem)) {\r\n          w = stem;\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1] + fp[2];\r\n        re2 = re_mgr1;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      // Step 5\r\n      re = re_5;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        re2 = re_meq1;\r\n        re3 = re3_5;\r\n        if (re.test(stem) || (re2.test(stem) && !(re3.test(stem)))) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      re = re_5_1;\r\n      re2 = re_mgr1;\r\n      if (re.test(w) && re2.test(w)) {\r\n        re = re_1b_2;\r\n        w = w.replace(re, \"\");\r\n      }\r\n\r\n      // and turn initial Y back to y\r\n\r\n      if (firstch === \"y\") {\r\n        w = firstch.toLowerCase() + w.substr(1);\r\n      }\r\n\r\n      return w;\r\n    };\r\n\r\n    return porterStemmer(word);\r\n  }\r\n}\r\n","/**\r\n * Pipeline Extension: StopWordFilter\r\n */\r\nexport class StopWordFilter {\r\n\r\n  /**\r\n   * Strip out stop words from the token and\r\n   * return the result\r\n   * @param  {string} token\r\n   * @return {string}\r\n   */\r\n  static run(token) {\r\n    if (token && StopWordFilter.stopWords[token] !== true) {\r\n      return token;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Clears the inner list of stop words\r\n   */\r\n  static clearStopWords() {\r\n    StopWordFilter.stopWords = {};\r\n  }\r\n\r\n  /**\r\n   * Register a list of stop words\r\n   * @param {string[]} words\r\n   */\r\n  static addStopWords(words) {\r\n    if (words == null || Array.isArray(words) === false) return;\r\n\r\n    words.forEach(function (word) {\r\n      StopWordFilter.stopWords[word] = true;\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Reset to use default stop words\r\n   */\r\n  static resetStopWords() {\r\n    StopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n  }\r\n}\r\n\r\nStopWordFilter.defaultStopWords = {\r\n  \"\": true,\r\n  \"a\": true,\r\n  \"able\": true,\r\n  \"about\": true,\r\n  \"across\": true,\r\n  \"after\": true,\r\n  \"all\": true,\r\n  \"almost\": true,\r\n  \"also\": true,\r\n  \"am\": true,\r\n  \"among\": true,\r\n  \"an\": true,\r\n  \"and\": true,\r\n  \"any\": true,\r\n  \"are\": true,\r\n  \"as\": true,\r\n  \"at\": true,\r\n  \"be\": true,\r\n  \"because\": true,\r\n  \"been\": true,\r\n  \"but\": true,\r\n  \"by\": true,\r\n  \"can\": true,\r\n  \"cannot\": true,\r\n  \"could\": true,\r\n  \"dear\": true,\r\n  \"did\": true,\r\n  \"do\": true,\r\n  \"does\": true,\r\n  \"either\": true,\r\n  \"else\": true,\r\n  \"ever\": true,\r\n  \"every\": true,\r\n  \"for\": true,\r\n  \"from\": true,\r\n  \"get\": true,\r\n  \"got\": true,\r\n  \"had\": true,\r\n  \"has\": true,\r\n  \"have\": true,\r\n  \"he\": true,\r\n  \"her\": true,\r\n  \"hers\": true,\r\n  \"him\": true,\r\n  \"his\": true,\r\n  \"how\": true,\r\n  \"however\": true,\r\n  \"i\": true,\r\n  \"if\": true,\r\n  \"in\": true,\r\n  \"into\": true,\r\n  \"is\": true,\r\n  \"it\": true,\r\n  \"its\": true,\r\n  \"just\": true,\r\n  \"least\": true,\r\n  \"let\": true,\r\n  \"like\": true,\r\n  \"likely\": true,\r\n  \"may\": true,\r\n  \"me\": true,\r\n  \"might\": true,\r\n  \"most\": true,\r\n  \"must\": true,\r\n  \"my\": true,\r\n  \"neither\": true,\r\n  \"no\": true,\r\n  \"nor\": true,\r\n  \"not\": true,\r\n  \"of\": true,\r\n  \"off\": true,\r\n  \"often\": true,\r\n  \"on\": true,\r\n  \"only\": true,\r\n  \"or\": true,\r\n  \"other\": true,\r\n  \"our\": true,\r\n  \"own\": true,\r\n  \"rather\": true,\r\n  \"said\": true,\r\n  \"say\": true,\r\n  \"says\": true,\r\n  \"she\": true,\r\n  \"should\": true,\r\n  \"since\": true,\r\n  \"so\": true,\r\n  \"some\": true,\r\n  \"than\": true,\r\n  \"that\": true,\r\n  \"the\": true,\r\n  \"their\": true,\r\n  \"them\": true,\r\n  \"then\": true,\r\n  \"there\": true,\r\n  \"these\": true,\r\n  \"they\": true,\r\n  \"this\": true,\r\n  \"tis\": true,\r\n  \"to\": true,\r\n  \"too\": true,\r\n  \"twas\": true,\r\n  \"us\": true,\r\n  \"wants\": true,\r\n  \"was\": true,\r\n  \"we\": true,\r\n  \"were\": true,\r\n  \"what\": true,\r\n  \"when\": true,\r\n  \"where\": true,\r\n  \"which\": true,\r\n  \"while\": true,\r\n  \"who\": true,\r\n  \"whom\": true,\r\n  \"why\": true,\r\n  \"will\": true,\r\n  \"with\": true,\r\n  \"would\": true,\r\n  \"yet\": true,\r\n  \"you\": true,\r\n  \"your\": true\r\n};\r\n\r\nStopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n","/**\r\n * Pipeline Extension: Trimmer\r\n */\r\nexport class Trimmer {\r\n\r\n  /**\r\n   * Trim non word characters from the begining and end of a string\r\n   * and return the result\r\n   * @param  {string} token\r\n   * @return {string}\r\n   */\r\n  static run(token) {\r\n    if (token === null || token === undefined) {\r\n      throw new Error('token should not be undefined');\r\n    }\r\n\r\n    return token\r\n      .replace(/^\\W+/, '')\r\n      .replace(/\\W+$/, '');\r\n  }\r\n}\r\n","import {Pipeline} from './core/pipeline.js';\r\nimport {DocumentStore} from './core/document_store.js';\r\nimport {InvertedIndex} from './core/inverted_index.js';\r\nimport {Configuration} from './core/configuration.js';\r\nimport {Tokenizer} from './core/tokenizer.js';\r\nimport {EventEmitter} from './events/event_emitter.js';\r\n\r\n/**\r\n * A dataset maintained by Lunastra and exposing its public facing API.\r\n */\r\nexport class Index {\r\n\r\n  /**\r\n   * Initialize an index\r\n   */\r\n  constructor() {\r\n    this._fields = [];\r\n    this._id = 'id';\r\n    this._idfCache = {};\r\n\r\n    this.index = {};\r\n\r\n    this.pipeline = new Pipeline();\r\n    this.documentStore = new DocumentStore();\r\n    this.eventEmitter = new EventEmitter();\r\n\r\n    this.on('add', 'remove', 'update', (function () {\r\n      this._idfCache = {};\r\n    }).bind(this));\r\n  }\r\n\r\n  /**\r\n   * Return the fields registered in the index\r\n   * @return {string[]}\r\n   */\r\n  getFields() {\r\n    return this._fields.slice();\r\n  }\r\n\r\n  /**\r\n   * Register a field in the index\r\n   * @param {string} fieldName\r\n   */\r\n  addField(fieldName) {\r\n    this._fields.push(fieldName);\r\n    this.index[fieldName] = new InvertedIndex();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the field used to uniquely identify a document (default is 'id')\r\n   * @param {string} fieldName\r\n   */\r\n  setId(fieldName) {\r\n    this._id = fieldName;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Bind a handler to the specified events\r\n   * @param  {...string} events\r\n   * @param {function} f\r\n   */\r\n  on(...args) {\r\n    return this.eventEmitter.addListener.apply(this.eventEmitter, args);\r\n  }\r\n\r\n  /**\r\n   * Unbind a handler from an event\r\n   * @param  {string} event\r\n   * @param  {function} f\r\n   */\r\n  off(event, fn) {\r\n    return this.eventEmitter.removeListener(event, fn);\r\n  }\r\n\r\n  /**\r\n   * Sets whether origin JSON documents are stored\r\n   * @param  {boolean} save default true\r\n   * @return {this}\r\n   */\r\n  saveDocument(save) {\r\n    this.documentStore = new DocumentStore(save);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a document to the index\r\n   * @param {object} doc\r\n   * @param {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  addDoc(doc, emitEvent = true) {\r\n    if (!doc) return;\r\n\r\n    var id = doc[this._id];\r\n\r\n    this.documentStore.addDoc(id, doc);\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      this.documentStore.addFieldLength(id, field, fieldTokens.length);\r\n\r\n      var tokenCount = {};\r\n      fieldTokens.forEach(function (token) {\r\n        if (token in tokenCount) tokenCount[token] += 1;\r\n        else tokenCount[token] = 1;\r\n      }, this);\r\n\r\n      for (var token in tokenCount) {\r\n        var termFrequency = tokenCount[token];\r\n        termFrequency = Math.sqrt(termFrequency);\r\n        this.index[field].addToken(token, { id: id, tf: termFrequency });\r\n      }\r\n\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('add', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the index by its unique id\r\n   * @param  {string|number} id\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  removeDocById(id, emitEvent = true) {\r\n    if (!id) return;\r\n    if (this.documentStore.isDocStored() === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.documentStore.hasDoc(id)) return;\r\n    var doc = this.documentStore.getDoc(id);\r\n    this.removeDoc(doc, emitEvent);\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the index\r\n   * @param  {object} doc\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  removeDoc(doc, emitEvent = true) {\r\n    if (!doc) return;\r\n\r\n    var id = doc[this._id];\r\n    if (!this.documentStore.hasDoc(id)) return;\r\n\r\n    this.documentStore.removeDoc(id);\r\n\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      fieldTokens.forEach(function (token) {\r\n        this.index[field].removeToken(token, id);\r\n      }, this);\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('remove', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Update a document in the index\r\n   * @param  {object} doc\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  updateDoc(doc, emitEvent = true) {\r\n\r\n    this.removeDocById(doc[this._id], false);\r\n    this.addDoc(doc, false);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('update', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Searches the index using the passed query.\r\n   * Queries should be a string, multiple words are allowed.\r\n   *\r\n   * If config is null, will search all fields defaultly, and lead to OR based query.\r\n   * If config is specified, will search specified with query time boosting.\r\n   *\r\n   * All query tokens are passed through the same pipeline that document tokens\r\n   * are passed through, so any language processing involved will be run on every\r\n   * query term.\r\n   *\r\n   * Each query term is expanded, so that the term 'he' might be expanded to\r\n   * 'hello' and 'help' if those terms were already included in the index.\r\n   *\r\n   * Matching documents are returned as an array of objects, each object contains\r\n   * the matching document id, as set for this index, and the similarity score\r\n   * for this document against the query.\r\n   *\r\n   * @param {string} query The query to search the index with.\r\n   * @param {JSON} userConfig The user query config, JSON format.\r\n   * @return {object}\r\n   */\r\n  search(query, userConfig) {\r\n    if (!query) return [];\r\n    if (typeof query === 'string') {\r\n      query = {any: query};\r\n    } else {\r\n      query = JSON.parse(JSON.stringify(query));\r\n    }\r\n\r\n    var configStr = null;\r\n    if (userConfig != null) {\r\n      configStr = JSON.stringify(userConfig);\r\n    }\r\n\r\n    var config = new Configuration(configStr, this.getFields()).get();\r\n\r\n    var queryTokens = {};\r\n    var queryFields = Object.keys(query);\r\n\r\n    for (var i = 0; i < queryFields.length; i++) {\r\n      var key = queryFields[i];\r\n\r\n      queryTokens[key] = this.pipeline.run(Tokenizer.tokenize(query[key]));\r\n    }\r\n\r\n    var queryResults = {};\r\n\r\n    for (var field in config) {\r\n      var tokens = queryTokens[field] || queryTokens.any;\r\n      if (!tokens) {\r\n        continue;\r\n      }\r\n\r\n      var fieldSearchResults = this.fieldSearch(tokens, field, config);\r\n      var fieldBoost = config[field].boost;\r\n\r\n      for (let id in fieldSearchResults) {\r\n        fieldSearchResults[id] = fieldSearchResults[id] * fieldBoost;\r\n      }\r\n\r\n      for (let id in fieldSearchResults) {\r\n        if (id in queryResults) {\r\n          queryResults[id] += fieldSearchResults[id];\r\n        } else {\r\n          queryResults[id] = fieldSearchResults[id];\r\n        }\r\n      }\r\n    }\r\n\r\n    var results = [];\r\n    var result;\r\n    for (var id in queryResults) {\r\n      result = {id: id, score: queryResults[id]};\r\n      if (this.documentStore.hasDoc(id)) {\r\n        result.doc = this.documentStore.getDoc(id);\r\n      }\r\n      results.push(result);\r\n    }\r\n\r\n    results.sort(function (a, b) { return b.score - a.score; });\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Search a list of tokens within a field\r\n   * @param  {string[]} queryTokens\r\n   * @param  {string} fieldName\r\n   * @param  {Configuration} config\r\n   * @return {object}\r\n   */\r\n  fieldSearch(queryTokens, fieldName, config) {\r\n    var booleanType = config[fieldName].bool;\r\n    var expand = config[fieldName].expand;\r\n    var boost = config[fieldName].boost;\r\n    var scores = null;\r\n    var docTokens = {};\r\n\r\n    // Do nothing if the boost is 0\r\n    if (boost === 0) {\r\n      return undefined;\r\n    }\r\n\r\n    queryTokens.forEach(function (token) {\r\n      var tokens = [token];\r\n      if (expand) {\r\n        tokens = this.index[fieldName].expandToken(token);\r\n      }\r\n\r\n      var queryTokenScores = {};\r\n      tokens.forEach(function (key) {\r\n        var docs = this.index[fieldName].getDocs(key);\r\n        var idf = this.idf(key, fieldName);\r\n\r\n        if (scores && booleanType === 'AND') {\r\n          // special case, we can rule out documents that have been\r\n          // already been filtered out because they weren't scored\r\n          // by previous query token passes.\r\n          var filteredDocs = {};\r\n          for (let id in scores) {\r\n            if (id in docs) {\r\n              filteredDocs[id] = docs[id];\r\n            }\r\n          }\r\n          docs = filteredDocs;\r\n        }\r\n\r\n        if (key === token) {\r\n          this.fieldSearchStats(docTokens, key, docs);\r\n        }\r\n\r\n        for (var id in docs) {\r\n          var tf = this.index[fieldName].getTermFrequency(key, id);\r\n          var fieldLength = this.documentStore.getFieldLength(id, fieldName);\r\n          var fieldLengthNorm = 1;\r\n          if (fieldLength !== 0) {\r\n            fieldLengthNorm = 1 / Math.sqrt(fieldLength);\r\n          }\r\n\r\n          var penality = 1;\r\n          if (key !== token) {\r\n            penality = (1 - (key.length - token.length) / key.length) * 0.15;\r\n          }\r\n\r\n          var score = tf * idf * fieldLengthNorm * penality;\r\n\r\n          if (id in queryTokenScores) {\r\n            queryTokenScores[id] += score;\r\n          } else {\r\n            queryTokenScores[id] = score;\r\n          }\r\n        }\r\n      }, this);\r\n\r\n      scores = this.mergeScores(scores, queryTokenScores, booleanType);\r\n    }, this);\r\n\r\n    scores = this.coordNorm(scores, docTokens, queryTokens.length);\r\n    return scores;\r\n  }\r\n\r\n  /**\r\n   * Merge the scores from one set of tokens into an accumulated score table.\r\n   * Exact operation depends on the op parameter. If op is 'AND', then only the\r\n   * intersection of the two score lists is retained. Otherwise, the union of\r\n   * the two score lists is returned.\r\n   * @param {boolean} accumScores should be null on first call\r\n   * @param {object} scores new scores to merge into accumScores\r\n   * @param {string} op merge operation (should be 'AND' or 'OR')\r\n   */\r\n  mergeScores(accumScores, scores, op) {\r\n    if (!accumScores) {\r\n      return scores;\r\n    }\r\n    if (op === 'AND') {\r\n      var intersection = {};\r\n      for (let id in scores) {\r\n        if (id in accumScores) {\r\n          intersection[id] = accumScores[id] + scores[id];\r\n        }\r\n      }\r\n      return intersection;\r\n    }\r\n\r\n    for (var id in scores) {\r\n      if (id in accumScores) {\r\n        accumScores[id] += scores[id];\r\n      } else {\r\n        accumScores[id] = scores[id];\r\n      }\r\n    }\r\n    return accumScores;\r\n  }\r\n\r\n  /**\r\n   * Record query tokens of retrieved documents\r\n   * @param  {object} docTokens\r\n   * @param  {string} token\r\n   * @param  {object} docs\r\n   */\r\n  fieldSearchStats(docTokens, token, docs) {\r\n    for (var doc in docs) {\r\n      if (doc in docTokens) {\r\n        docTokens[doc].push(token);\r\n      } else {\r\n        docTokens[doc] = [token];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the inverse document frequency of a term within a field\r\n   * @param  {string} term\r\n   * @param  {string} field\r\n   * @return {number}\r\n   */\r\n  idf(term, field) {\r\n    var cacheKey = \"@\" + field + '/' + term;\r\n    if (Object.prototype.hasOwnProperty.call(this._idfCache, cacheKey)) return this._idfCache[cacheKey];\r\n\r\n    var df = this.index[field].getDocFreq(term);\r\n    var idf = 1 + Math.log(this.documentStore.length / (df + 1));\r\n    this._idfCache[cacheKey] = idf;\r\n\r\n    return idf;\r\n  }\r\n\r\n  /**\r\n   * Get the normalized coordination factor\r\n   * @param  {object} scores\r\n   * @param  {oobject} docTokens\r\n   * @param  {number} n\r\n   * @return {object}\r\n   */\r\n  coordNorm(scores, docTokens, n) {\r\n    for (var doc in scores) {\r\n      if (!(doc in docTokens)) continue;\r\n      var tokens = docTokens[doc].length;\r\n      scores[doc] = scores[doc] * tokens / n;\r\n    }\r\n\r\n    return scores;\r\n  }\r\n\r\n}\r\n","import {Index} from './index.js';\r\nimport {Trimmer} from './exts/trimmer.js';\r\nimport {StopWordFilter} from './exts/stop_word_filters.js';\r\nimport {Stemmer} from './exts/stemmer.js';\r\n\r\n/**\r\n * A helper method to initialize a Lunastra Index\r\n * @param  {object} config\r\n * @return {Index}\r\n */\r\nexport function init(config) {\r\n  var index = new Index();\r\n\r\n  index.pipeline.add(\r\n    Trimmer,\r\n    StopWordFilter,\r\n    Stemmer\r\n  );\r\n\r\n  if (config) config.call(index, index);\r\n\r\n  return index;\r\n}\r\n\r\nexport * from './index.js';\r\nexport * from './core/configuration.js';\r\nexport * from './core/document_store.js';\r\nexport * from './core/tokenizer.js';\r\nexport * from './core/inverted_index.js';\r\nexport * from './core/pipeline.js';\r\nexport * from './events/event_emitter.js';\r\nexport * from './exts/stemmer.js';\r\nexport * from './exts/stop_word_filters.js';\r\nexport * from './exts/trimmer.js';\r\nexport * from './utils/utils.js';\r\n","/**\r\n * Print a warning message to the console\r\n * @param  {string} message\r\n */\r\nexport function warn(global) {\r\n  return function (message) {\r\n    if (global.console && console.warn) {\r\n      console.warn(message);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Returns and empty string for null and undefined,\r\n * otherwise returns the result of the object's\r\n * '.toString()' method\r\n * @param  {object} obj\r\n * @return {string}\r\n */\r\nexport function toString(obj) {\r\n  if (obj === undefined || obj === null) return \"\";\r\n\r\n  return obj.toString();\r\n}\r\n\r\n/**\r\n * Return a deep copy of the object\r\n * @param  {object} obj\r\n * @return {object}\r\n */\r\nexport function clone(obj) {\r\n  if (obj === null || typeof obj !== \"object\") return obj;\r\n  var copy = obj.constructor();\r\n\r\n  for (var attr in obj) {\r\n    if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\r\n  }\r\n  return copy;\r\n}\r\n"],"sourceRoot":""}