{"version":3,"sources":["webpack://Lunastra/webpack/universalModuleDefinition","webpack://Lunastra/webpack/bootstrap","webpack://Lunastra/./src/configuration.js","webpack://Lunastra/./src/document_store.js","webpack://Lunastra/./src/event_emitter.js","webpack://Lunastra/./src/index.js","webpack://Lunastra/./src/inverted_index.js","webpack://Lunastra/./src/lunastra.js","webpack://Lunastra/./src/pipeline.js","webpack://Lunastra/./src/stemmer.js","webpack://Lunastra/./src/stop_word_filters.js","webpack://Lunastra/./src/tokenizer.js","webpack://Lunastra/./src/trimmer.js","webpack://Lunastra/./src/utils.js"],"names":["Configuration","config","fields","undefined","Error","userConfig","length","buildDefaultConfig","JSON","parse","buildUserConfig","error","reset","forEach","field","boost","bool","expand","globalBool","globalExpand","indexOf","fieldConfig","fieldExpand","addAllFieldsToUserConfig","DocumentStore","save","deepcpy","_save","_deepcpy","docs","docInfo","docRef","hasDoc","doc","fieldName","addFieldLength","EventEmitter","events","event","args","f","pop","TypeError","hasHandler","push","fIndex","splice","apply","Index","_fields","_ref","_idfCache","index","pipeline","documentStore","eventEmitter","on","bind","slice","addListener","fn","removeListener","emitEvent","addDoc","fieldTokens","run","tokenize","tokenCount","token","termFrequency","Math","sqrt","addToken","ref","tf","emit","isDocStored","getDoc","removeDoc","removeToken","removeDocByRef","query","any","stringify","configStr","getFields","get","queryTokens","queryFields","Object","keys","i","key","queryResults","tokens","fieldSearchResults","fieldSearch","fieldBoost","results","result","score","sort","a","b","booleanType","scores","docTokens","expandToken","queryTokenScores","getDocs","idf","filteredDocs","fieldSearchStats","getTermFrequency","fieldLength","getFieldLength","fieldLengthNorm","penality","mergeScores","coordNorm","accumScores","op","intersection","term","cacheKey","prototype","hasOwnProperty","call","df","getDocFreq","log","n","InvertedIndex","root","tokenInfo","node","getNode","memo","init","add","trim","filter","stem","Pipeline","_queue","fs","existingFct","newFct","pos","out","queueLength","pipelineOutput","j","output","Array","isArray","k","Stemmer","word","step2list","step3list","c","v","C","V","mgr0","meq1","mgr1","s_v","re_mgr0","RegExp","re_mgr1","re_meq1","re_s_v","re_1a","re2_1a","re_1b","re2_1b","re_1b_2","re2_1b_2","re3_1b_2","re4_1b_2","re_1c","re_2","re_3","re_4","re2_4","re_5","re_5_1","re3_5","porterStemmer","w","suffix","firstch","re","re2","re3","re4","fp","substr","toUpperCase","test","replace","exec","toLowerCase","StopWordFilter","stopWords","words","defaultStopWords","Tokenizer","str","arguments","arr","map","t","item","split","separator","concat","toString","sep","defaultSeparator","Trimmer","warn","global","message","console","obj","clone","copy","constructor","attr"],"mappings":"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","file":"Lunastra.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Lunastra\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Lunastra\"] = factory();\n\telse\n\t\troot[\"Lunastra\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/lunastra.js\");\n","import {warn} from './utils.js';\r\n\r\n/**\r\n * A wrapper on a user search configuration.\r\n */\r\nexport class Configuration {\r\n\r\n  /**\r\n   * Initialize a configuration\r\n   * @param  {string} config\r\n   * @param  {string[]} fields\r\n   */\r\n  constructor(config, fields) {\r\n    config = config || '';\r\n\r\n    if (fields === undefined || fields == null) {\r\n      throw new Error('fields should not be null');\r\n    }\r\n\r\n    this.config = {};\r\n\r\n    var userConfig;\r\n    if (config.length === 0) {\r\n      this.buildDefaultConfig(fields);\r\n    } else {\r\n      try {\r\n        userConfig = JSON.parse(config);\r\n        this.buildUserConfig(userConfig, fields);\r\n      } catch (error) {\r\n        warn('user configuration parse failed, will use default configuration');\r\n        this.buildDefaultConfig(fields);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current user config\r\n   * @return {JSON}\r\n   */\r\n  get() {\r\n    return this.config;\r\n  }\r\n\r\n  /**\r\n   * Reset user search configuration\r\n   */\r\n  reset() {\r\n    this.config = {};\r\n  }\r\n\r\n  /**\r\n   * Build default search configuration\r\n   * @private\r\n   * @param  {string[]} fields\r\n   */\r\n  buildDefaultConfig(fields) {\r\n    this.reset();\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: \"OR\",\r\n        expand: false\r\n      };\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Build user search configuration\r\n   * @private\r\n   * @param  {JSON} config\r\n   * @param  {string[]} fields\r\n   */\r\n  buildUserConfig(config, fields) {\r\n    var globalBool = \"OR\";\r\n    var globalExpand = false;\r\n\r\n    this.reset();\r\n    if ('bool' in config) {\r\n      globalBool = config['bool'] || globalBool;\r\n    }\r\n\r\n    if ('expand' in config) {\r\n      globalExpand = config['expand'] || globalExpand;\r\n    }\r\n\r\n    if ('fields' in config) {\r\n      for (var field in config['fields']) {\r\n        if (fields.indexOf(field) > -1) {\r\n          var fieldConfig = config['fields'][field];\r\n          var fieldExpand = globalExpand;\r\n          if (fieldConfig.expand != null) {\r\n            fieldExpand = fieldConfig.expand;\r\n          }\r\n\r\n          this.config[field] = {\r\n            boost: (fieldConfig.boost || fieldConfig.boost === 0) ? fieldConfig.boost : 1,\r\n            bool: fieldConfig.bool || globalBool,\r\n            expand: fieldExpand\r\n          };\r\n        } else {\r\n          warn('field name in user configuration not found in index instance fields');\r\n        }\r\n      }\r\n    } else {\r\n      this.addAllFieldsToUserConfig(globalBool, globalExpand, fields);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a fields to user search configuration\r\n   * @param {string} bool   Boolean model\r\n   * @param {string} expand Expand model\r\n   * @param {string[]} fields fields of the index instance\r\n   */\r\n  addAllFieldsToUserConfig(bool, expand, fields) {\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: bool,\r\n        expand: expand\r\n      };\r\n    }, this);\r\n  }\r\n\r\n}\r\n","import {clone} from './utils.js';\r\n\r\n/**\r\n * A key-value document store used for storing sets of tokens for\r\n * documents stored in the index.\r\n */\r\nexport class DocumentStore {\r\n\r\n  /**\r\n   * Initialize a document store\r\n   * @param  {boolean} save    whether to store original documents\r\n   * @param  {boolean} deepcpy whether to deep copy the original documents\r\n   */\r\n  constructor(save = true, deepcpy = true) {\r\n    this._save = (save !== false);\r\n    this._deepcpy = (deepcpy !== false);\r\n    this.docs = {};\r\n    this.docInfo = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  get deepcpy() {return this._deepcpy;}\r\n\r\n  isDocStored() {return this._save;}\r\n\r\n  /**\r\n   * Check whether a given document ref is stored\r\n   * @param  {string|number}  docRef\r\n   * @return {boolean}\r\n   */\r\n  hasDoc(docRef) {\r\n    return docRef in this.docs;\r\n  }\r\n\r\n  /**\r\n   * Get a document by its ref\r\n   * @param  {string|number} docRef\r\n   * @return {object}\r\n   */\r\n  getDoc(docRef) {\r\n    if (this.hasDoc(docRef) === false) return null;\r\n    return this.docs[docRef];\r\n  }\r\n\r\n  /**\r\n   * Store a document or update it if it already exists\r\n   * @param {string|number} docRef\r\n   * @param {object} doc\r\n   */\r\n  addDoc(docRef, doc) {\r\n    if (!this.hasDoc(docRef)) this.length++;\r\n\r\n    this.docs[docRef] = this._save ? (this.deepcpy ? clone(doc) : doc) : null;\r\n\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the store by its ref\r\n   * @param  {string|number} docRef\r\n   */\r\n  removeDoc(docRef) {\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    delete this.docs[docRef];\r\n    delete this.docInfo[docRef];\r\n    this.length--;\r\n  }\r\n\r\n  /**\r\n   * Get the field length of a document by its ref\r\n   *\r\n   * @param {number|string} docRef document id or reference\r\n   * @param {string} fieldName field name\r\n   * @return {number} field length\r\n   */\r\n  getFieldLength(docRef, fieldName) {\r\n    if (docRef === null || docRef === undefined) return 0;\r\n\r\n    if (!(docRef in this.docs)) return 0;\r\n    if (!(fieldName in this.docInfo[docRef])) return 0;\r\n    return this.docInfo[docRef][fieldName];\r\n  };\r\n\r\n  /**\r\n   * Add field length of a document's field tokens from pipeline results.\r\n   * The field length of a document is used to do field length normalization\r\n   * even without the original JSON document stored.\r\n   * @param {number|string} docRef document's id or reference\r\n   * @param {string} fieldName field name\r\n   * @param {number} length field length\r\n   */\r\n  addFieldLength(docRef, fieldName, length) {\r\n    if (docRef === null || docRef === undefined) return;\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    if (!this.docInfo[docRef]) this.docInfo[docRef] = {};\r\n    this.docInfo[docRef][fieldName] = length;\r\n  }\r\n\r\n  /**\r\n   * Update field length of a document's field tokens from pipeline results.\r\n   * The field length of a document is used to do field length normalization\r\n   * even without the original JSON document stored.\r\n   * @param {number|string} docRef document's id or reference\r\n   * @param {string} fieldName field name\r\n   * @param {number} length field length\r\n   */\r\n  updateFieldLength(docRef, fieldName, length) {\r\n    if (docRef === null || docRef === undefined) return;\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    this.addFieldLength(docRef, fieldName, length);\r\n  }\r\n}\r\n","/**\r\n * An event manager for Lunastra.\r\n */\r\nexport class EventEmitter {\r\n\r\n  /**\r\n   * Initialize an event emitter\r\n   */\r\n  constructor() {\r\n    this.events = {};\r\n  }\r\n\r\n  /**\r\n   * Check whether an event is registered\r\n   * @private\r\n   * @param {string} event\r\n   * @return {boolean}\r\n   */\r\n  hasHandler(event) {\r\n    return event in this.events;\r\n  };\r\n\r\n  /**\r\n   * Bind a handler function to a specific event(s).\r\n   *\r\n   * Can bind a single function to many different events in one call.\r\n   *\r\n   * @param {string} events the name(s) of events to bind this function to\r\n   * @param {function} f the function to call when an event is fired\r\n   */\r\n  addListener(...args) {\r\n    var f = args.pop();\r\n    var events = args;\r\n\r\n    if (typeof f !== \"function\") throw new TypeError(\"Last argument must be a function\");\r\n\r\n    events.forEach(function (event) {\r\n      if (!this.hasHandler(event)) this.events[event] = [];\r\n      this.events[event].push(f);\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Unbind a handler from an event\r\n   * @param  {string} event\r\n   * @param  {function} f\r\n   */\r\n  removeListener(event, f) {\r\n    if (!this.hasHandler(event)) return;\r\n\r\n    var fIndex = this.events[event].indexOf(f);\r\n    if (fIndex === -1) return;\r\n\r\n    this.events[event].splice(fIndex, 1);\r\n\r\n    if (this.events[event].length === 0) delete this.events[event];\r\n  }\r\n\r\n  /**\r\n   * Emit an event\r\n   * @param  {string} event the event to emit\r\n   * @param {...any} args additional data that the event should expose\r\n   */\r\n  emit(event, ...args) {\r\n    if (!this.hasHandler(event)) return;\r\n\r\n    this.events[event].forEach(function (f) {\r\n      f.apply(undefined, args);\r\n    }, this);\r\n  }\r\n}\r\n","import {Pipeline} from './pipeline.js';\r\nimport {DocumentStore} from './document_store.js';\r\nimport {EventEmitter} from './event_emitter.js';\r\nimport {InvertedIndex} from './inverted_index.js';\r\nimport {Configuration} from './configuration.js';\r\nimport {Tokenizer} from './tokenizer.js';\r\n\r\n/**\r\n * A dataset maintained by Lunastra and exposing its public facing API.\r\n */\r\nexport class Index {\r\n\r\n  /**\r\n   * Initialize an index\r\n   */\r\n  constructor() {\r\n    this._fields = [];\r\n    this._ref = 'id';\r\n    this._idfCache = {};\r\n\r\n    this.index = {};\r\n\r\n    this.pipeline = new Pipeline();\r\n    this.documentStore = new DocumentStore();\r\n    this.eventEmitter = new EventEmitter();\r\n\r\n    this.on('add', 'remove', 'update', (function () {\r\n      this._idfCache = {};\r\n    }).bind(this));\r\n  }\r\n\r\n  /**\r\n   * Return the fields registered in the index\r\n   * @return {string[]}\r\n   */\r\n  getFields() {\r\n    return this._fields.slice();\r\n  }\r\n\r\n  /**\r\n   * Register a field in the index\r\n   * @param {string} fieldName\r\n   */\r\n  addField(fieldName) {\r\n    this._fields.push(fieldName);\r\n    this.index[fieldName] = new InvertedIndex();\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Set the field used to uniquely identify a document (default is 'id')\r\n   * @param {string} fieldName\r\n   */\r\n  setRef(fieldName) {\r\n    this._ref = fieldName;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Bind a handler to the specified events\r\n   * @param  {...string} events\r\n   * @param {function} f\r\n   */\r\n  on(...args) {\r\n    return this.eventEmitter.addListener.apply(this.eventEmitter, args);\r\n  }\r\n\r\n  /**\r\n   * Unbind a handler from an event\r\n   * @param  {string} event\r\n   * @param  {function} f\r\n   */\r\n  off(event, fn) {\r\n    return this.eventEmitter.removeListener(event, fn);\r\n  }\r\n\r\n  /**\r\n   * Sets whether origin JSON documents are stored\r\n   * @param  {boolean} save default true\r\n   * @return {this}\r\n   */\r\n  saveDocument(save) {\r\n    this.documentStore = new DocumentStore(save);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a document to the index\r\n   * @param {object} doc\r\n   * @param {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  addDoc(doc, emitEvent) {\r\n    if (!doc) return;\r\n    emitEvent = (emitEvent === undefined) ? true : emitEvent;\r\n\r\n    var docRef = doc[this._ref];\r\n\r\n    this.documentStore.addDoc(docRef, doc);\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      this.documentStore.addFieldLength(docRef, field, fieldTokens.length);\r\n\r\n      var tokenCount = {};\r\n      fieldTokens.forEach(function (token) {\r\n        if (token in tokenCount) tokenCount[token] += 1;\r\n        else tokenCount[token] = 1;\r\n      }, this);\r\n\r\n      for (var token in tokenCount) {\r\n        var termFrequency = tokenCount[token];\r\n        termFrequency = Math.sqrt(termFrequency);\r\n        this.index[field].addToken(token, { ref: docRef, tf: termFrequency });\r\n      }\r\n\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('add', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the index by its unique id\r\n   * @param  {string|number} docRef\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  removeDocByRef(docRef, emitEvent) {\r\n    if (!docRef) return;\r\n    if (this.documentStore.isDocStored() === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.documentStore.hasDoc(docRef)) return;\r\n    var doc = this.documentStore.getDoc(docRef);\r\n    this.removeDoc(doc, false);\r\n  }\r\n\r\n  /**\r\n   * Remove a document from the index\r\n   * @param  {object} doc\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  removeDoc(doc, emitEvent) {\r\n    if (!doc) return;\r\n\r\n    emitEvent = emitEvent === undefined ? true : emitEvent;\r\n\r\n    var docRef = doc[this._ref];\r\n    if (!this.documentStore.hasDoc(docRef)) return;\r\n\r\n    this.documentStore.removeDoc(docRef);\r\n\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      fieldTokens.forEach(function (token) {\r\n        this.index[field].removeToken(token, docRef);\r\n      }, this);\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('remove', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Update a document in the index\r\n   * @param  {object} doc\r\n   * @param  {boolean} emitEvent whether an event should be triggered\r\n   */\r\n  updateDoc(doc, emitEvent) {\r\n    emitEvent = emitEvent === undefined ? true : emitEvent;\r\n\r\n    this.removeDocByRef(doc[this._ref], false);\r\n    this.addDoc(doc, false);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('update', doc, this);\r\n  }\r\n\r\n  /**\r\n   * Searches the index using the passed query.\r\n   * Queries should be a string, multiple words are allowed.\r\n   *\r\n   * If config is null, will search all fields defaultly, and lead to OR based query.\r\n   * If config is specified, will search specified with query time boosting.\r\n   *\r\n   * All query tokens are passed through the same pipeline that document tokens\r\n   * are passed through, so any language processing involved will be run on every\r\n   * query term.\r\n   *\r\n   * Each query term is expanded, so that the term 'he' might be expanded to\r\n   * 'hello' and 'help' if those terms were already included in the index.\r\n   *\r\n   * Matching documents are returned as an array of objects, each object contains\r\n   * the matching document ref, as set for this index, and the similarity score\r\n   * for this document against the query.\r\n   *\r\n   * @param {string} query The query to search the index with.\r\n   * @param {JSON} userConfig The user query config, JSON format.\r\n   * @return {object}\r\n   */\r\n  search(query, userConfig) {\r\n    if (!query) return [];\r\n    if (typeof query === 'string') {\r\n      query = {any: query};\r\n    } else {\r\n      query = JSON.parse(JSON.stringify(query));\r\n    }\r\n\r\n    var configStr = null;\r\n    if (userConfig != null) {\r\n      configStr = JSON.stringify(userConfig);\r\n    }\r\n\r\n    var config = new Configuration(configStr, this.getFields()).get();\r\n\r\n    var queryTokens = {};\r\n    var queryFields = Object.keys(query);\r\n\r\n    for (var i = 0; i < queryFields.length; i++) {\r\n      var key = queryFields[i];\r\n\r\n      queryTokens[key] = this.pipeline.run(Tokenizer.tokenize(query[key]));\r\n    }\r\n\r\n    var queryResults = {};\r\n\r\n    for (var field in config) {\r\n      var tokens = queryTokens[field] || queryTokens.any;\r\n      if (!tokens) {\r\n        continue;\r\n      }\r\n\r\n      var fieldSearchResults = this.fieldSearch(tokens, field, config);\r\n      var fieldBoost = config[field].boost;\r\n\r\n      for (let docRef in fieldSearchResults) {\r\n        fieldSearchResults[docRef] = fieldSearchResults[docRef] * fieldBoost;\r\n      }\r\n\r\n      for (let docRef in fieldSearchResults) {\r\n        if (docRef in queryResults) {\r\n          queryResults[docRef] += fieldSearchResults[docRef];\r\n        } else {\r\n          queryResults[docRef] = fieldSearchResults[docRef];\r\n        }\r\n      }\r\n    }\r\n\r\n    var results = [];\r\n    var result;\r\n    for (var docRef in queryResults) {\r\n      result = {ref: docRef, score: queryResults[docRef]};\r\n      if (this.documentStore.hasDoc(docRef)) {\r\n        result.doc = this.documentStore.getDoc(docRef);\r\n      }\r\n      results.push(result);\r\n    }\r\n\r\n    results.sort(function (a, b) { return b.score - a.score; });\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Search a list of tokens within a field\r\n   * @private\r\n   * @param  {string[]} queryTokens\r\n   * @param  {string} fieldName\r\n   * @param  {Configuration} config\r\n   * @return {object}\r\n   */\r\n  fieldSearch(queryTokens, fieldName, config) {\r\n    var booleanType = config[fieldName].bool;\r\n    var expand = config[fieldName].expand;\r\n    var boost = config[fieldName].boost;\r\n    var scores = null;\r\n    var docTokens = {};\r\n\r\n    // Do nothing if the boost is 0\r\n    if (boost === 0) {\r\n      return undefined;\r\n    }\r\n\r\n    queryTokens.forEach(function (token) {\r\n      var tokens = [token];\r\n      if (expand) {\r\n        tokens = this.index[fieldName].expandToken(token);\r\n      }\r\n\r\n      var queryTokenScores = {};\r\n      tokens.forEach(function (key) {\r\n        var docs = this.index[fieldName].getDocs(key);\r\n        var idf = this.idf(key, fieldName);\r\n\r\n        if (scores && booleanType === 'AND') {\r\n          // special case, we can rule out documents that have been\r\n          // already been filtered out because they weren't scored\r\n          // by previous query token passes.\r\n          var filteredDocs = {};\r\n          for (let docRef in scores) {\r\n            if (docRef in docs) {\r\n              filteredDocs[docRef] = docs[docRef];\r\n            }\r\n          }\r\n          docs = filteredDocs;\r\n        }\r\n\r\n        if (key === token) {\r\n          this.fieldSearchStats(docTokens, key, docs);\r\n        }\r\n\r\n        for (var docRef in docs) {\r\n          var tf = this.index[fieldName].getTermFrequency(key, docRef);\r\n          var fieldLength = this.documentStore.getFieldLength(docRef, fieldName);\r\n          var fieldLengthNorm = 1;\r\n          if (fieldLength !== 0) {\r\n            fieldLengthNorm = 1 / Math.sqrt(fieldLength);\r\n          }\r\n\r\n          var penality = 1;\r\n          if (key !== token) {\r\n            penality = (1 - (key.length - token.length) / key.length) * 0.15;\r\n          }\r\n\r\n          var score = tf * idf * fieldLengthNorm * penality;\r\n\r\n          if (docRef in queryTokenScores) {\r\n            queryTokenScores[docRef] += score;\r\n          } else {\r\n            queryTokenScores[docRef] = score;\r\n          }\r\n        }\r\n      }, this);\r\n\r\n      scores = this.mergeScores(scores, queryTokenScores, booleanType);\r\n    }, this);\r\n\r\n    scores = this.coordNorm(scores, docTokens, queryTokens.length);\r\n    return scores;\r\n  }\r\n\r\n  /**\r\n   * Merge the scores from one set of tokens into an accumulated score table.\r\n   * Exact operation depends on the op parameter. If op is 'AND', then only the\r\n   * intersection of the two score lists is retained. Otherwise, the union of\r\n   * the two score lists is returned.\r\n   * @private\r\n   * @param {boolean} accumScores should be null on first call\r\n   * @param {object} scores new scores to merge into accumScores\r\n   * @param {string} op merge operation (should be 'AND' or 'OR')\r\n   */\r\n  mergeScores(accumScores, scores, op) {\r\n    if (!accumScores) {\r\n      return scores;\r\n    }\r\n    if (op === 'AND') {\r\n      var intersection = {};\r\n      for (let docRef in scores) {\r\n        if (docRef in accumScores) {\r\n          intersection[docRef] = accumScores[docRef] + scores[docRef];\r\n        }\r\n      }\r\n      return intersection;\r\n    }\r\n\r\n    for (var docRef in scores) {\r\n      if (docRef in accumScores) {\r\n        accumScores[docRef] += scores[docRef];\r\n      } else {\r\n        accumScores[docRef] = scores[docRef];\r\n      }\r\n    }\r\n    return accumScores;\r\n  }\r\n\r\n  /**\r\n   * Record query tokens of retrieved documents\r\n   * @private\r\n   * @param  {object} docTokens\r\n   * @param  {string} token\r\n   * @param  {object} docs\r\n   */\r\n  fieldSearchStats(docTokens, token, docs) {\r\n    for (var doc in docs) {\r\n      if (doc in docTokens) {\r\n        docTokens[doc].push(token);\r\n      } else {\r\n        docTokens[doc] = [token];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate the inverse document frequency of a term within a field\r\n   * @private\r\n   * @param  {string} term\r\n   * @param  {string} field\r\n   * @return {number}\r\n   */\r\n  idf(term, field) {\r\n    var cacheKey = \"@\" + field + '/' + term;\r\n    if (Object.prototype.hasOwnProperty.call(this._idfCache, cacheKey)) return this._idfCache[cacheKey];\r\n\r\n    var df = this.index[field].getDocFreq(term);\r\n    var idf = 1 + Math.log(this.documentStore.length / (df + 1));\r\n    this._idfCache[cacheKey] = idf;\r\n\r\n    return idf;\r\n  }\r\n\r\n  /**\r\n   * Get the normalized coordination factor\r\n   * @private\r\n   * @param  {object} scores\r\n   * @param  {oobject} docTokens\r\n   * @param  {number} n\r\n   * @return {object}\r\n   */\r\n  coordNorm(scores, docTokens, n) {\r\n    for (var doc in scores) {\r\n      if (!(doc in docTokens)) continue;\r\n      var tokens = docTokens[doc].length;\r\n      scores[doc] = scores[doc] * tokens / n;\r\n    }\r\n\r\n    return scores;\r\n  }\r\n\r\n}\r\n","/**\r\n * The entity on which queries are executed upon.\r\n */\r\nexport class InvertedIndex {\r\n\r\n  /**\r\n   * Initialize an inverted index\r\n   */\r\n  constructor() {\r\n    this.root = { docs: {}, df: 0};\r\n  }\r\n\r\n  /**\r\n     * Adds a {token: tokenInfo} pair to the inverted index.\r\n     * If the token already exist, then update the tokenInfo.\r\n     *\r\n     * tokenInfo format: { ref: 1, tf: 2}\r\n     * tokenInfo should contains the document's ref and the tf(token frequency) of that token in\r\n     * the document.\r\n     *\r\n     * By default this function starts at the root of the current inverted index, however\r\n     * it can start at any node of the inverted index if required.\r\n     *\r\n     * @param {string} token\r\n     * @param {object} tokenInfo format: { ref: 1, tf: 2}\r\n     * @param {object} root An optional node at which to start looking for the\r\n     * correct place to enter the doc, by default the root of this InvertedIndex\r\n     * is used.\r\n   */\r\n  addToken(token, tokenInfo, root) {\r\n    root = root || this.root;\r\n\r\n    for (var i = 0; i < token.length; ++i) {\r\n      var key = token[i];\r\n\r\n      if (!(key in root)) root[key] = {docs: {}, df: 0};\r\n      root = root[key];\r\n    }\r\n\r\n    var docRef = tokenInfo.ref;\r\n    if (!root.docs[docRef]) {\r\n      // if this doc not exist, then add this doc\r\n      root.docs[docRef] = {tf: tokenInfo.tf};\r\n      root.df += 1;\r\n    } else {\r\n      // if this doc already exist, then update tokenInfo\r\n      root.docs[docRef] = {tf: tokenInfo.tf};\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check whether the token is stored in this inverted index\r\n   * @param  {string}  token\r\n   * @return {boolean}\r\n   */\r\n  hasToken(token) {\r\n    if (!token) return false;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return false;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Get a node from the inverted index for a given token.\r\n   * If token not found in this InvertedIndex, return null.\r\n   * @param {string} token The token to get the node for.\r\n   * @return {object}\r\n   */\r\n  getNode(token) {\r\n    if (!token) return null;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return null;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  /**\r\n   * Get the documents of a given token.\r\n   * If token not found, return {}.\r\n   * @param {string} token The token to get the documents for.\r\n   * @return {object}\r\n   */\r\n  getDocs(token) {\r\n    var node = this.getNode(token);\r\n    if (node == null) {\r\n      return {};\r\n    }\r\n\r\n    return node.docs;\r\n  }\r\n\r\n  /**\r\n   * Get term frequency of given token in given document unique id.\r\n   * If token or document id not found, return 0.\r\n   * @param {string} token the token to get the documents for\r\n   * @param {string|number} docRef the unique id of the document\r\n   * @return {number}\r\n   */\r\n  getTermFrequency(token, docRef) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    if (!(docRef in node.docs)) {\r\n      return 0;\r\n    }\r\n\r\n    return node.docs[docRef].tf;\r\n  }\r\n\r\n  /**\r\n   * Get the document frequency of given token.\r\n   * If token not found, return 0.\r\n   * @param {string} token the token to get the documents for\r\n   * @return {object}\r\n   */\r\n  getDocFreq(token) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    return node.df;\r\n  }\r\n\r\n  /**\r\n   * Remove the document identified by document's ref from the token in the inverted index.\r\n   * @param {string} token remove the document from token\r\n   * @param {string} ref the ref of the document to remove from given token\r\n   */\r\n  removeToken(token, ref) {\r\n    if (!token) return;\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) return;\r\n\r\n    if (ref in node.docs) {\r\n      delete node.docs[ref];\r\n      node.df -= 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Find all the possible suffixes of given token using tokens currently in the inverted index.\r\n   * If token not found, return empty Array.\r\n   * @param {string} token the token to expand\r\n   * @return {string[]}\r\n   */\r\n  expandToken(token, memo, root) {\r\n    if (token == null || token === '') return [];\r\n    memo = memo || [];\r\n\r\n    if (root == null) {\r\n      root = this.getNode(token);\r\n      if (root == null) return memo;\r\n    }\r\n\r\n    if (root.df > 0) memo.push(token);\r\n\r\n    for (var key in root) {\r\n      if (key === 'docs') continue;\r\n      if (key === 'df') continue;\r\n      this.expandToken(token + key, memo, root[key]);\r\n    }\r\n\r\n    return memo;\r\n  }\r\n\r\n}\r\n","import {Index} from './index.js';\r\nimport {Trimmer} from './trimmer.js';\r\nimport {StopWordFilter} from './stop_word_filters.js';\r\nimport {Stemmer} from './stemmer.js';\r\n\r\n/**\r\n * A helper method to initialize a Lunastra Index\r\n * @param  {object} config\r\n * @return {Index}\r\n */\r\nexport function init(config) {\r\n  var index = new Index();\r\n\r\n  index.pipeline.add(\r\n    Trimmer.trim,\r\n    StopWordFilter.filter,\r\n    Stemmer.stem\r\n  );\r\n\r\n  if (config) config.call(index, index);\r\n\r\n  return index;\r\n}\r\n\r\nexport * from './configuration.js';\r\nexport * from './document_store.js';\r\nexport * from './event_emitter.js';\r\nexport * from './index.js';\r\nexport * from './inverted_index.js';\r\nexport * from './pipeline.js';\r\nexport * from './stemmer.js';\r\nexport * from './stop_word_filters.js';\r\nexport * from './tokenizer.js';\r\nexport * from './trimmer.js';\r\nexport * from './utils.js';\r\n","/**\r\n * An ordered list of functions applied to both document\r\n * tokens and query tokens.\r\n */\r\nexport class Pipeline {\r\n\r\n  /**\r\n   * Initialize a pipeline\r\n   */\r\n  constructor() {\r\n    this._queue = [];\r\n  }\r\n\r\n  /**\r\n   * Return the stored list of functions\r\n   * @return {function[]}\r\n   */\r\n  get() {\r\n    return this._queue;\r\n  }\r\n\r\n  /**\r\n   * Push functions to the end of the pipeline\r\n   * @param {...function} fs\r\n   */\r\n  add(...fs) {\r\n    fs.forEach(function (f) {\r\n      this._queue.push(f);\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Insert a function after a function present in the pipeline\r\n   * @param  {function} existingFct\r\n   * @param  {function} newFct\r\n   */\r\n  after(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos + 1, 0, newFct);\r\n  };\r\n\r\n  /**\r\n   * Insert a function before a function present in the pipeline\r\n   * @param  {function} existingFct\r\n   * @param  {function} newFct\r\n   */\r\n  before(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos, 0, newFct);\r\n  };\r\n\r\n  /**\r\n   * Remove a function from the pipeline\r\n   * @param  {function} f\r\n   */\r\n  remove(f) {\r\n    var pos = this._queue.indexOf(f);\r\n    if (pos === -1) return;\r\n\r\n    this._queue.splice(pos, 1);\r\n  };\r\n\r\n  /**\r\n   * Remove and return the last function in the pipeline\r\n   * @return {function}\r\n   */\r\n  pop() {\r\n    return this._queue.pop();\r\n  }\r\n\r\n  /**\r\n   * Empty the pipeline\r\n   */\r\n  clear() {\r\n    this._queue = [];\r\n  }\r\n\r\n  /**\r\n   * Run each function stored in the pipeline on the input tokens\r\n   * in FIFO order and returns the result\r\n   * @param  {string[]} tokens\r\n   * @return {string[]}\r\n   */\r\n  run(tokens) {\r\n    var out = tokens;\r\n    var queueLength = this._queue.length;\r\n    for (var i = 0; i < queueLength; i++) {\r\n      var pipelineOutput = [];\r\n      for (let j = 0; j < out.length; j++) {\r\n        var output = this._queue[i](out[j], j, out);\r\n        if (!Array.isArray(output)) output = [output];\r\n        for (var k = 0; k < output.length; k++) {\r\n          if (output[k] !== null && output[k] !== void 0) {\r\n            pipelineOutput.push(output[k]);\r\n          }\r\n        }\r\n      }\r\n      for (var j = pipelineOutput.length - 1; j >= 0; j--) {\r\n        if (pipelineOutput[j] === \"\") pipelineOutput.splice(j, 1);\r\n      }\r\n      out = pipelineOutput;\r\n    }\r\n\r\n    return out;\r\n  }\r\n}\r\n","/* eslint camelcase: 0 */\r\n/* eslint max-len: 0 */\r\n/* eslint brace-style: 0 */\r\n\r\n/**\r\n * Pipeline Extension: Stemmer\r\n */\r\nexport class Stemmer {\r\n\r\n  /**\r\n   * Reduce a word to its root and return the result\r\n   * (implementation of the PorterStemmer taken from http://tartarus.org/~martin)\r\n   * @param  {string} word\r\n   * @return {string}\r\n   */\r\n  static stem(word) {\r\n    var step2list = {\r\n        \"ational\": \"ate\",\r\n        \"tional\": \"tion\",\r\n        \"enci\": \"ence\",\r\n        \"anci\": \"ance\",\r\n        \"izer\": \"ize\",\r\n        \"bli\": \"ble\",\r\n        \"alli\": \"al\",\r\n        \"entli\": \"ent\",\r\n        \"eli\": \"e\",\r\n        \"ousli\": \"ous\",\r\n        \"ization\": \"ize\",\r\n        \"ation\": \"ate\",\r\n        \"ator\": \"ate\",\r\n        \"alism\": \"al\",\r\n        \"iveness\": \"ive\",\r\n        \"fulness\": \"ful\",\r\n        \"ousness\": \"ous\",\r\n        \"aliti\": \"al\",\r\n        \"iviti\": \"ive\",\r\n        \"biliti\": \"ble\",\r\n        \"logi\": \"log\"\r\n      },\r\n\r\n      step3list = {\r\n        \"icate\": \"ic\",\r\n        \"ative\": \"\",\r\n        \"alize\": \"al\",\r\n        \"iciti\": \"ic\",\r\n        \"ical\": \"ic\",\r\n        \"ful\": \"\",\r\n        \"ness\": \"\"\r\n      },\r\n\r\n      c = \"[^aeiou]\", // consonant\r\n      v = \"[aeiouy]\", // vowel\r\n      C = c + \"[^aeiouy]*\", // consonant sequence\r\n      V = v + \"[aeiou]*\", // vowel sequence\r\n\r\n      mgr0 = \"^(\" + C + \")?\" + V + C, // [C]VC... is m>0\r\n      meq1 = \"^(\" + C + \")?\" + V + C + \"(\" + V + \")?$\", // [C]VC[V] is m=1\r\n      mgr1 = \"^(\" + C + \")?\" + V + C + V + C, // [C]VCVC... is m>1\r\n      s_v = \"^(\" + C + \")?\" + v; // vowel in stem\r\n\r\n    var re_mgr0 = new RegExp(mgr0);\r\n    var re_mgr1 = new RegExp(mgr1);\r\n    var re_meq1 = new RegExp(meq1);\r\n    var re_s_v = new RegExp(s_v);\r\n\r\n    var re_1a = /^(.+?)(ss|i)es$/;\r\n    var re2_1a = /^(.+?)([^s])s$/;\r\n    var re_1b = /^(.+?)eed$/;\r\n    var re2_1b = /^(.+?)(ed|ing)$/;\r\n    var re_1b_2 = /.$/;\r\n    var re2_1b_2 = /(at|bl|iz)$/;\r\n    var re3_1b_2 = new RegExp(\"([^aeiouylsz])\\\\1$\");\r\n    var re4_1b_2 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    var re_1c = /^(.+?[^aeiou])y$/;\r\n    var re_2 = /^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;\r\n\r\n    var re_3 = /^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;\r\n\r\n    var re_4 = /^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;\r\n    var re2_4 = /^(.+?)(s|t)(ion)$/;\r\n\r\n    var re_5 = /^(.+?)e$/;\r\n    var re_5_1 = /ll$/;\r\n    var re3_5 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    function porterStemmer(w) {\r\n      var stem,\r\n        suffix,\r\n        firstch,\r\n        re,\r\n        re2,\r\n        re3,\r\n        re4,\r\n        fp;\r\n\r\n      if (w.length < 3) { return w; }\r\n\r\n      firstch = w.substr(0, 1);\r\n      if (firstch === \"y\") {\r\n        w = firstch.toUpperCase() + w.substr(1);\r\n      }\r\n\r\n      // Step 1a\r\n      re = re_1a;\r\n      re2 = re2_1a;\r\n\r\n      if (re.test(w)) {w = w.replace(re, \"$1$2\");}\r\n      else if (re2.test(w)) {w = w.replace(re2, \"$1$2\");}\r\n\r\n      // Step 1b\r\n      re = re_1b;\r\n      re2 = re2_1b;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        re = re_mgr0;\r\n        if (re.test(fp[1])) {\r\n          re = re_1b_2;\r\n          w = w.replace(re, \"\");\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1];\r\n        re2 = re_s_v;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n          re2 = re2_1b_2;\r\n          re3 = re3_1b_2;\r\n          re4 = re4_1b_2;\r\n          if (re2.test(w)) { w = w + \"e\"; }\r\n          else if (re3.test(w)) { re = re_1b_2; w = w.replace(re, \"\"); }\r\n          else if (re4.test(w)) { w = w + \"e\"; }\r\n        }\r\n      }\r\n\r\n      // Step 1c - replace suffix y or Y by i if preceded by a non-vowel which is\r\n      // not the first letter of the word (so cry -> cri, by -> by, say -> say)\r\n      re = re_1c;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        w = stem + \"i\";\r\n      }\r\n\r\n      // Step 2\r\n      re = re_2;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step2list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 3\r\n      re = re_3;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step3list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 4\r\n      re = re_4;\r\n      re2 = re2_4;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        if (re.test(stem)) {\r\n          w = stem;\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1] + fp[2];\r\n        re2 = re_mgr1;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      // Step 5\r\n      re = re_5;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        re2 = re_meq1;\r\n        re3 = re3_5;\r\n        if (re.test(stem) || (re2.test(stem) && !(re3.test(stem)))) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      re = re_5_1;\r\n      re2 = re_mgr1;\r\n      if (re.test(w) && re2.test(w)) {\r\n        re = re_1b_2;\r\n        w = w.replace(re, \"\");\r\n      }\r\n\r\n      // and turn initial Y back to y\r\n\r\n      if (firstch === \"y\") {\r\n        w = firstch.toLowerCase() + w.substr(1);\r\n      }\r\n\r\n      return w;\r\n    };\r\n\r\n    return porterStemmer(word);\r\n  }\r\n}\r\n","/**\r\n * Pipeline Extension: StopWordFilter\r\n */\r\nexport class StopWordFilter {\r\n\r\n  /**\r\n   * Strip out stop words from the token and\r\n   * return the result\r\n   * @param  {string} token\r\n   * @return {string}\r\n   */\r\n  static filter(token) {\r\n    if (token && StopWordFilter.stopWords[token] !== true) {\r\n      return token;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Clears the inner list of stop words\r\n   */\r\n  static clearStopWords() {\r\n    StopWordFilter.stopWords = {};\r\n  }\r\n\r\n  /**\r\n   * Register a list of stop words\r\n   * @param {string[]} words\r\n   */\r\n  static addStopWords(words) {\r\n    if (words == null || Array.isArray(words) === false) return;\r\n\r\n    words.forEach(function (word) {\r\n      StopWordFilter.stopWords[word] = true;\r\n    }, this);\r\n  }\r\n\r\n  /**\r\n   * Reset to use default stop words\r\n   */\r\n  static resetStopWords() {\r\n    StopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n  }\r\n}\r\n\r\nStopWordFilter.defaultStopWords = {\r\n  \"\": true,\r\n  \"a\": true,\r\n  \"able\": true,\r\n  \"about\": true,\r\n  \"across\": true,\r\n  \"after\": true,\r\n  \"all\": true,\r\n  \"almost\": true,\r\n  \"also\": true,\r\n  \"am\": true,\r\n  \"among\": true,\r\n  \"an\": true,\r\n  \"and\": true,\r\n  \"any\": true,\r\n  \"are\": true,\r\n  \"as\": true,\r\n  \"at\": true,\r\n  \"be\": true,\r\n  \"because\": true,\r\n  \"been\": true,\r\n  \"but\": true,\r\n  \"by\": true,\r\n  \"can\": true,\r\n  \"cannot\": true,\r\n  \"could\": true,\r\n  \"dear\": true,\r\n  \"did\": true,\r\n  \"do\": true,\r\n  \"does\": true,\r\n  \"either\": true,\r\n  \"else\": true,\r\n  \"ever\": true,\r\n  \"every\": true,\r\n  \"for\": true,\r\n  \"from\": true,\r\n  \"get\": true,\r\n  \"got\": true,\r\n  \"had\": true,\r\n  \"has\": true,\r\n  \"have\": true,\r\n  \"he\": true,\r\n  \"her\": true,\r\n  \"hers\": true,\r\n  \"him\": true,\r\n  \"his\": true,\r\n  \"how\": true,\r\n  \"however\": true,\r\n  \"i\": true,\r\n  \"if\": true,\r\n  \"in\": true,\r\n  \"into\": true,\r\n  \"is\": true,\r\n  \"it\": true,\r\n  \"its\": true,\r\n  \"just\": true,\r\n  \"least\": true,\r\n  \"let\": true,\r\n  \"like\": true,\r\n  \"likely\": true,\r\n  \"may\": true,\r\n  \"me\": true,\r\n  \"might\": true,\r\n  \"most\": true,\r\n  \"must\": true,\r\n  \"my\": true,\r\n  \"neither\": true,\r\n  \"no\": true,\r\n  \"nor\": true,\r\n  \"not\": true,\r\n  \"of\": true,\r\n  \"off\": true,\r\n  \"often\": true,\r\n  \"on\": true,\r\n  \"only\": true,\r\n  \"or\": true,\r\n  \"other\": true,\r\n  \"our\": true,\r\n  \"own\": true,\r\n  \"rather\": true,\r\n  \"said\": true,\r\n  \"say\": true,\r\n  \"says\": true,\r\n  \"she\": true,\r\n  \"should\": true,\r\n  \"since\": true,\r\n  \"so\": true,\r\n  \"some\": true,\r\n  \"than\": true,\r\n  \"that\": true,\r\n  \"the\": true,\r\n  \"their\": true,\r\n  \"them\": true,\r\n  \"then\": true,\r\n  \"there\": true,\r\n  \"these\": true,\r\n  \"they\": true,\r\n  \"this\": true,\r\n  \"tis\": true,\r\n  \"to\": true,\r\n  \"too\": true,\r\n  \"twas\": true,\r\n  \"us\": true,\r\n  \"wants\": true,\r\n  \"was\": true,\r\n  \"we\": true,\r\n  \"were\": true,\r\n  \"what\": true,\r\n  \"when\": true,\r\n  \"where\": true,\r\n  \"which\": true,\r\n  \"while\": true,\r\n  \"who\": true,\r\n  \"whom\": true,\r\n  \"why\": true,\r\n  \"will\": true,\r\n  \"with\": true,\r\n  \"would\": true,\r\n  \"yet\": true,\r\n  \"you\": true,\r\n  \"your\": true\r\n};\r\n\r\nStopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n","import {toString} from './utils.js';\r\n\r\n/**\r\n * A wrapper around how Lunastra tokenizes strings\r\n */\r\nexport class Tokenizer {\r\n\r\n  /**\r\n   * Split a string into a list of tokens\r\n   * @param  {string} str\r\n   * @return {string[]}\r\n   */\r\n  static tokenize(str) {\r\n    if (!arguments.length || str === null || str === undefined) return [];\r\n    if (Array.isArray(str)) {\r\n      var arr = str.filter(function (token) {\r\n        if (token === null || token === undefined) {\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      });\r\n\r\n      arr = arr.map(function (t) {\r\n        return toString(t).toLowerCase();\r\n      });\r\n\r\n      var out = [];\r\n      arr.forEach(function (item) {\r\n        var tokens = item.split(Tokenizer.separator);\r\n        out = out.concat(tokens);\r\n      }, this);\r\n\r\n      return out;\r\n    }\r\n\r\n    return str.toString().trim().toLowerCase().split(Tokenizer.separator);\r\n  }\r\n\r\n  /**\r\n   * Get the seperator\r\n   * @return {string|regexp}\r\n   */\r\n  static getSeparator() {\r\n    return Tokenizer.separator;\r\n  }\r\n\r\n  /**\r\n   * Set the seperator\r\n   * @param {string|regexp} sep\r\n   */\r\n  static setSeparator(sep) {\r\n    Tokenizer.separator = sep;\r\n  }\r\n\r\n  /**\r\n   * Reset to the default seperator\r\n   */\r\n  static resetSeparator() {\r\n    Tokenizer.separator = Tokenizer.defaultSeparator;\r\n  }\r\n\r\n}\r\n\r\nTokenizer.defaultSeparator = /[\\s\\-]+/;\r\nTokenizer.separator = Tokenizer.defaultSeparator;\r\n","/**\r\n * Pipeline Extension: Trimmer\r\n */\r\nexport class Trimmer {\r\n\r\n  /**\r\n   * Trim non word characters from the begining and end of a string\r\n   * and return the result\r\n   * @param  {string} token\r\n   * @return {string}\r\n   */\r\n  static trim(token) {\r\n    if (token === null || token === undefined) {\r\n      throw new Error('token should not be undefined');\r\n    }\r\n\r\n    return token\r\n      .replace(/^\\W+/, '')\r\n      .replace(/\\W+$/, '');\r\n  }\r\n}\r\n","/**\r\n * Print a warning message to the console\r\n * @param  {string} message\r\n */\r\nexport function warn(global) {\r\n  return function (message) {\r\n    if (global.console && console.warn) {\r\n      console.warn(message);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Returns and empty string for null and undefined,\r\n * otherwise returns the result of the object's\r\n * '.toString()' method\r\n * @param  {object} obj\r\n * @return {string}\r\n */\r\nexport function toString(obj) {\r\n  if (obj === undefined || obj === null) return \"\";\r\n\r\n  return obj.toString();\r\n}\r\n\r\n/**\r\n * Return a deep copy of the object\r\n * @param  {object} obj\r\n * @return {object}\r\n */\r\nexport function clone(obj) {\r\n  if (obj === null || typeof obj !== \"object\") return obj;\r\n  var copy = obj.constructor();\r\n\r\n  for (var attr in obj) {\r\n    if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\r\n  }\r\n  return copy;\r\n}\r\n"],"sourceRoot":""}