{"version":3,"sources":["webpack://lunastra/webpack/universalModuleDefinition","webpack://lunastra/webpack/bootstrap","webpack://lunastra/./src/configuration.js","webpack://lunastra/./src/document_store.js","webpack://lunastra/./src/event_emitter.js","webpack://lunastra/./src/index.js","webpack://lunastra/./src/inverted_index.js","webpack://lunastra/./src/lunastra.js","webpack://lunastra/./src/pipeline.js","webpack://lunastra/./src/stemmer.js","webpack://lunastra/./src/stop_word_filters.js","webpack://lunastra/./src/tokenizer.js","webpack://lunastra/./src/trimmer.js","webpack://lunastra/./src/utils.js"],"names":["Configuration","config","fields","undefined","Error","userConfig","length","buildDefaultConfig","JSON","parse","buildUserConfig","error","reset","forEach","field","boost","bool","expand","globalBool","globalExpand","indexOf","fieldConfig","fieldExpand","addAllFieldsToUserConfig","DocumentStore","save","deepcpy","_save","_deepcpy","docs","docInfo","docRef","hasDoc","doc","fieldName","addFieldLength","EventEmitter","events","name","args","Array","prototype","slice","call","arguments","f","pop","names","TypeError","hasHandler","push","fIndex","splice","apply","Index","_fields","_ref","_idfCache","index","pipeline","documentStore","eventEmitter","on","bind","refName","addListener","fn","removeListener","emitEvent","addDoc","fieldTokens","run","tokenize","tokenCount","token","termFrequency","Math","sqrt","addToken","ref","tf","emit","isDocStored","getDoc","removeDoc","removeToken","removeDocByRef","term","cacheKey","Object","hasOwnProperty","df","getDocFreq","idf","log","query","any","stringify","configStr","getFields","get","queryTokens","queryFields","keys","i","key","queryResults","tokens","fieldSearchResults","fieldSearch","fieldBoost","results","result","score","sort","a","b","booleanType","scores","docTokens","expandToken","queryTokenScores","getDocs","filteredDocs","fieldSearchStats","getTermFrequency","fieldLength","getFieldLength","fieldLengthNorm","penality","mergeScores","coordNorm","accumScores","op","intersection","n","plugin","unshift","InvertedIndex","root","tokenInfo","node","getNode","memo","init","add","trim","filter","stem","Pipeline","_queue","fs","existingFct","newFct","pos","out","queueLength","pipelineOutput","j","output","isArray","k","Stemmer","word","step2list","step3list","c","v","C","V","mgr0","meq1","mgr1","s_v","re_mgr0","RegExp","re_mgr1","re_meq1","re_s_v","re_1a","re2_1a","re_1b","re2_1b","re_1b_2","re2_1b_2","re3_1b_2","re4_1b_2","re_1c","re_2","re_3","re_4","re2_4","re_5","re_5_1","re3_5","porterStemmer","w","suffix","firstch","re","re2","re3","re4","fp","substr","toUpperCase","test","replace","exec","toLowerCase","StopWordFilter","stopWords","words","defaultStopWords","Tokenizer","str","arr","map","t","item","split","separator","concat","toString","sep","defaultSeparator","Trimmer","warn","global","message","console","obj","clone","copy","constructor","attr"],"mappings":"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","file":"lunastra.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"lunastra\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"lunastra\"] = factory();\n\telse\n\t\troot[\"lunastra\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/lunastra.js\");\n","import {warn} from './utils.js';\r\n\r\nexport class Configuration {\r\n\r\n  constructor(config, fields) {\r\n    config = config || '';\r\n\r\n    if (fields === undefined || fields == null) {\r\n      throw new Error('fields should not be null');\r\n    }\r\n\r\n    this.config = {};\r\n\r\n    var userConfig;\r\n    if (config.length === 0) {\r\n      this.buildDefaultConfig(fields);\r\n    } else {\r\n      try {\r\n        userConfig = JSON.parse(config);\r\n        this.buildUserConfig(userConfig, fields);\r\n      } catch (error) {\r\n        warn('user configuration parse failed, will use default configuration');\r\n        this.buildDefaultConfig(fields);\r\n      }\r\n    }\r\n  }\r\n\r\n  get() {\r\n    return this.config;\r\n  }\r\n\r\n  reset() {\r\n    this.config = {};\r\n  }\r\n\r\n  buildDefaultConfig(fields) {\r\n    this.reset();\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: \"OR\",\r\n        expand: false\r\n      };\r\n    }, this);\r\n  }\r\n\r\n  buildUserConfig(config, fields) {\r\n    var globalBool = \"OR\";\r\n    var globalExpand = false;\r\n\r\n    this.reset();\r\n    if ('bool' in config) {\r\n      globalBool = config['bool'] || globalBool;\r\n    }\r\n\r\n    if ('expand' in config) {\r\n      globalExpand = config['expand'] || globalExpand;\r\n    }\r\n\r\n    if ('fields' in config) {\r\n      for (var field in config['fields']) {\r\n        if (fields.indexOf(field) > -1) {\r\n          var fieldConfig = config['fields'][field];\r\n          var fieldExpand = globalExpand;\r\n          if (fieldConfig.expand != null) {\r\n            fieldExpand = fieldConfig.expand;\r\n          }\r\n\r\n          this.config[field] = {\r\n            boost: (fieldConfig.boost || fieldConfig.boost === 0) ? fieldConfig.boost : 1,\r\n            bool: fieldConfig.bool || globalBool,\r\n            expand: fieldExpand\r\n          };\r\n        } else {\r\n          warn('field name in user configuration not found in index instance fields');\r\n        }\r\n      }\r\n    } else {\r\n      this.addAllFieldsToUserConfig(globalBool, globalExpand, fields);\r\n    }\r\n  }\r\n\r\n  addAllFieldsToUserConfig(bool, expand, fields) {\r\n    fields.forEach(function (field) {\r\n      this.config[field] = {\r\n        boost: 1,\r\n        bool: bool,\r\n        expand: expand\r\n      };\r\n    }, this);\r\n  }\r\n\r\n}\r\n","import {clone} from './utils.js';\r\n\r\nexport class DocumentStore {\r\n\r\n  constructor(save = true, deepcpy = true) {\r\n    this._save = (save !== false);\r\n    this._deepcpy = (deepcpy !== false);\r\n    this.docs = {};\r\n    this.docInfo = {};\r\n    this.length = 0;\r\n  }\r\n\r\n  get deepcpy() {return this._deepcpy;}\r\n\r\n  isDocStored() {return this._save;}\r\n\r\n  hasDoc(docRef) {\r\n    return docRef in this.docs;\r\n  }\r\n\r\n  getDoc(docRef) {\r\n    if (this.hasDoc(docRef) === false) return null;\r\n    return this.docs[docRef];\r\n  }\r\n\r\n  addDoc(docRef, doc) {\r\n    if (!this.hasDoc(docRef)) this.length++;\r\n\r\n    this.docs[docRef] = this._save ? (this.deepcpy ? clone(doc) : doc) : null;\r\n\r\n  }\r\n\r\n  removeDoc(docRef) {\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    delete this.docs[docRef];\r\n    delete this.docInfo[docRef];\r\n    this.length--;\r\n  }\r\n\r\n  getFieldLength(docRef, fieldName) {\r\n    if (docRef === null || docRef === undefined) return 0;\r\n\r\n    if (!(docRef in this.docs)) return 0;\r\n    if (!(fieldName in this.docInfo[docRef])) return 0;\r\n    return this.docInfo[docRef][fieldName];\r\n  };\r\n\r\n  addFieldLength(docRef, fieldName, length) {\r\n    if (docRef === null || docRef === undefined) return;\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    if (!this.docInfo[docRef]) this.docInfo[docRef] = {};\r\n    this.docInfo[docRef][fieldName] = length;\r\n  }\r\n\r\n  updateFieldLength(docRef, fieldName, length) {\r\n    if (docRef === null || docRef === undefined) return;\r\n    if (!this.hasDoc(docRef)) return;\r\n\r\n    this.addFieldLength(docRef, fieldName, length);\r\n  }\r\n}\r\n","export class EventEmitter {\r\n\r\n  constructor() {\r\n    this.events = {};\r\n  }\r\n\r\n  hasHandler(name) {\r\n    return name in this.events;\r\n  };\r\n\r\n  addListener() {\r\n    var args = Array.prototype.slice.call(arguments);\r\n    var f = args.pop();\r\n    var names = args;\r\n\r\n    if (typeof f !== \"function\") throw new TypeError(\"Last argument must be a function\");\r\n\r\n    names.forEach(function (name) {\r\n      if (!this.hasHandler(name)) this.events[name] = [];\r\n      this.events[name].push(f);\r\n    }, this);\r\n  }\r\n\r\n  removeListener(name, f) {\r\n    if (!this.hasHandler(name)) return;\r\n\r\n    var fIndex = this.events[name].indexOf(f);\r\n    if (fIndex === -1) return;\r\n\r\n    this.events[name].splice(fIndex, 1);\r\n\r\n    if (this.events[name].length === 0) delete this.events[name];\r\n  }\r\n\r\n  emit(name) {\r\n    if (!this.hasHandler(name)) return;\r\n\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n\r\n    this.events[name].forEach(function (f) {\r\n      f.apply(undefined, args);\r\n    }, this);\r\n  }\r\n}\r\n","import {Pipeline} from './pipeline.js';\r\nimport {DocumentStore} from './document_store.js';\r\nimport {EventEmitter} from './event_emitter.js';\r\nimport {InvertedIndex} from './inverted_index.js';\r\nimport {Configuration} from './configuration.js';\r\nimport {Tokenizer} from './tokenizer.js';\r\n\r\nexport class Index {\r\n\r\n  constructor() {\r\n    this._fields = [];\r\n    this._ref = 'id';\r\n    this._idfCache = {};\r\n\r\n    this.index = {};\r\n\r\n    this.pipeline = new Pipeline();\r\n    this.documentStore = new DocumentStore();\r\n    this.eventEmitter = new EventEmitter();\r\n\r\n    this.on('add', 'remove', 'update', (function () {\r\n      this._idfCache = {};\r\n    }).bind(this));\r\n  }\r\n\r\n  getFields() {\r\n    return this._fields.slice();\r\n  }\r\n\r\n  setRef(refName) {\r\n    this._ref = refName;\r\n    return this;\r\n  }\r\n\r\n  on() {\r\n    var args = Array.prototype.slice.call(arguments);\r\n    return this.eventEmitter.addListener.apply(this.eventEmitter, args);\r\n  }\r\n\r\n  off(name, fn) {\r\n    return this.eventEmitter.removeListener(name, fn);\r\n  }\r\n\r\n  saveDocument(save) {\r\n    this.documentStore = new DocumentStore(save);\r\n    return this;\r\n  }\r\n\r\n  addDoc(doc, emitEvent) {\r\n    if (!doc) return;\r\n    emitEvent = (emitEvent === undefined) ? true : emitEvent;\r\n\r\n    var docRef = doc[this._ref];\r\n\r\n    this.documentStore.addDoc(docRef, doc);\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      this.documentStore.addFieldLength(docRef, field, fieldTokens.length);\r\n\r\n      var tokenCount = {};\r\n      fieldTokens.forEach(function (token) {\r\n        if (token in tokenCount) tokenCount[token] += 1;\r\n        else tokenCount[token] = 1;\r\n      }, this);\r\n\r\n      for (var token in tokenCount) {\r\n        var termFrequency = tokenCount[token];\r\n        termFrequency = Math.sqrt(termFrequency);\r\n        this.index[field].addToken(token, { ref: docRef, tf: termFrequency });\r\n      }\r\n\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('add', doc, this);\r\n  }\r\n\r\n  removeDocByRef(docRef, emitEvent) {\r\n    if (!docRef) return;\r\n    if (this.documentStore.isDocStored() === false) {\r\n      return;\r\n    }\r\n\r\n    if (!this.documentStore.hasDoc(docRef)) return;\r\n    var doc = this.documentStore.getDoc(docRef);\r\n    this.removeDoc(doc, false);\r\n  }\r\n\r\n  removeDoc(doc, emitEvent) {\r\n    if (!doc) return;\r\n\r\n    emitEvent = emitEvent === undefined ? true : emitEvent;\r\n\r\n    var docRef = doc[this._ref];\r\n    if (!this.documentStore.hasDoc(docRef)) return;\r\n\r\n    this.documentStore.removeDoc(docRef);\r\n\r\n    this._fields.forEach(function (field) {\r\n      var fieldTokens = this.pipeline.run(Tokenizer.tokenize(doc[field]));\r\n      fieldTokens.forEach(function (token) {\r\n        this.index[field].removeToken(token, docRef);\r\n      }, this);\r\n    }, this);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('remove', doc, this);\r\n  }\r\n\r\n  updateDoc(doc, emitEvent) {\r\n    emitEvent = emitEvent === undefined ? true : emitEvent;\r\n\r\n    this.removeDocByRef(doc[this._ref], false);\r\n    this.addDoc(doc, false);\r\n\r\n    if (emitEvent) this.eventEmitter.emit('update', doc, this);\r\n  }\r\n\r\n  addField(fieldName) {\r\n    this._fields.push(fieldName);\r\n    this.index[fieldName] = new InvertedIndex();\r\n    return this;\r\n  }\r\n\r\n  idf(term, field) {\r\n    var cacheKey = \"@\" + field + '/' + term;\r\n    if (Object.prototype.hasOwnProperty.call(this._idfCache, cacheKey)) return this._idfCache[cacheKey];\r\n\r\n    var df = this.index[field].getDocFreq(term);\r\n    var idf = 1 + Math.log(this.documentStore.length / (df + 1));\r\n    this._idfCache[cacheKey] = idf;\r\n\r\n    return idf;\r\n  }\r\n\r\n  search(query, userConfig) {\r\n    if (!query) return [];\r\n    if (typeof query === 'string') {\r\n      query = {any: query};\r\n    } else {\r\n      query = JSON.parse(JSON.stringify(query));\r\n    }\r\n\r\n    var configStr = null;\r\n    if (userConfig != null) {\r\n      configStr = JSON.stringify(userConfig);\r\n    }\r\n\r\n    var config = new Configuration(configStr, this.getFields()).get();\r\n\r\n    var queryTokens = {};\r\n    var queryFields = Object.keys(query);\r\n\r\n    for (var i = 0; i < queryFields.length; i++) {\r\n      var key = queryFields[i];\r\n\r\n      queryTokens[key] = this.pipeline.run(Tokenizer.tokenize(query[key]));\r\n    }\r\n\r\n    var queryResults = {};\r\n\r\n    for (var field in config) {\r\n      var tokens = queryTokens[field] || queryTokens.any;\r\n      if (!tokens) {\r\n        continue;\r\n      }\r\n\r\n      var fieldSearchResults = this.fieldSearch(tokens, field, config);\r\n      var fieldBoost = config[field].boost;\r\n\r\n      for (let docRef in fieldSearchResults) {\r\n        fieldSearchResults[docRef] = fieldSearchResults[docRef] * fieldBoost;\r\n      }\r\n\r\n      for (let docRef in fieldSearchResults) {\r\n        if (docRef in queryResults) {\r\n          queryResults[docRef] += fieldSearchResults[docRef];\r\n        } else {\r\n          queryResults[docRef] = fieldSearchResults[docRef];\r\n        }\r\n      }\r\n    }\r\n\r\n    var results = [];\r\n    var result;\r\n    for (var docRef in queryResults) {\r\n      result = {ref: docRef, score: queryResults[docRef]};\r\n      if (this.documentStore.hasDoc(docRef)) {\r\n        result.doc = this.documentStore.getDoc(docRef);\r\n      }\r\n      results.push(result);\r\n    }\r\n\r\n    results.sort(function (a, b) { return b.score - a.score; });\r\n    return results;\r\n  }\r\n\r\n  fieldSearch(queryTokens, fieldName, config) {\r\n    var booleanType = config[fieldName].bool;\r\n    var expand = config[fieldName].expand;\r\n    var boost = config[fieldName].boost;\r\n    var scores = null;\r\n    var docTokens = {};\r\n\r\n    // Do nothing if the boost is 0\r\n    if (boost === 0) {\r\n      return undefined;\r\n    }\r\n\r\n    queryTokens.forEach(function (token) {\r\n      var tokens = [token];\r\n      if (expand) {\r\n        tokens = this.index[fieldName].expandToken(token);\r\n      }\r\n\r\n      var queryTokenScores = {};\r\n      tokens.forEach(function (key) {\r\n        var docs = this.index[fieldName].getDocs(key);\r\n        var idf = this.idf(key, fieldName);\r\n\r\n        if (scores && booleanType === 'AND') {\r\n          // special case, we can rule out documents that have been\r\n          // already been filtered out because they weren't scored\r\n          // by previous query token passes.\r\n          var filteredDocs = {};\r\n          for (let docRef in scores) {\r\n            if (docRef in docs) {\r\n              filteredDocs[docRef] = docs[docRef];\r\n            }\r\n          }\r\n          docs = filteredDocs;\r\n        }\r\n\r\n        if (key === token) {\r\n          this.fieldSearchStats(docTokens, key, docs);\r\n        }\r\n\r\n        for (var docRef in docs) {\r\n          var tf = this.index[fieldName].getTermFrequency(key, docRef);\r\n          var fieldLength = this.documentStore.getFieldLength(docRef, fieldName);\r\n          var fieldLengthNorm = 1;\r\n          if (fieldLength !== 0) {\r\n            fieldLengthNorm = 1 / Math.sqrt(fieldLength);\r\n          }\r\n\r\n          var penality = 1;\r\n          if (key !== token) {\r\n            penality = (1 - (key.length - token.length) / key.length) * 0.15;\r\n          }\r\n\r\n          var score = tf * idf * fieldLengthNorm * penality;\r\n\r\n          if (docRef in queryTokenScores) {\r\n            queryTokenScores[docRef] += score;\r\n          } else {\r\n            queryTokenScores[docRef] = score;\r\n          }\r\n        }\r\n      }, this);\r\n\r\n      scores = this.mergeScores(scores, queryTokenScores, booleanType);\r\n    }, this);\r\n\r\n    scores = this.coordNorm(scores, docTokens, queryTokens.length);\r\n    return scores;\r\n  }\r\n\r\n  mergeScores(accumScores, scores, op) {\r\n    if (!accumScores) {\r\n      return scores;\r\n    }\r\n    if (op === 'AND') {\r\n      var intersection = {};\r\n      for (let docRef in scores) {\r\n        if (docRef in accumScores) {\r\n          intersection[docRef] = accumScores[docRef] + scores[docRef];\r\n        }\r\n      }\r\n      return intersection;\r\n    }\r\n\r\n    for (var docRef in scores) {\r\n      if (docRef in accumScores) {\r\n        accumScores[docRef] += scores[docRef];\r\n      } else {\r\n        accumScores[docRef] = scores[docRef];\r\n      }\r\n    }\r\n    return accumScores;\r\n  }\r\n\r\n  fieldSearchStats(docTokens, token, docs) {\r\n    for (var doc in docs) {\r\n      if (doc in docTokens) {\r\n        docTokens[doc].push(token);\r\n      } else {\r\n        docTokens[doc] = [token];\r\n      }\r\n    }\r\n  }\r\n\r\n  coordNorm(scores, docTokens, n) {\r\n    for (var doc in scores) {\r\n      if (!(doc in docTokens)) continue;\r\n      var tokens = docTokens[doc].length;\r\n      scores[doc] = scores[doc] * tokens / n;\r\n    }\r\n\r\n    return scores;\r\n  }\r\n\r\n  use(plugin) {\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n    args.unshift(this);\r\n    plugin.apply(this, args);\r\n  }\r\n\r\n}\r\n","export class InvertedIndex {\r\n\r\n  constructor() {\r\n    this.root = { docs: {}, df: 0};\r\n  }\r\n\r\n  addToken(token, tokenInfo, root) {\r\n    root = root || this.root;\r\n\r\n    for (var i = 0; i < token.length; ++i) {\r\n      var key = token[i];\r\n\r\n      if (!(key in root)) root[key] = {docs: {}, df: 0};\r\n      root = root[key];\r\n    }\r\n\r\n    var docRef = tokenInfo.ref;\r\n    if (!root.docs[docRef]) {\r\n      // if this doc not exist, then add this doc\r\n      root.docs[docRef] = {tf: tokenInfo.tf};\r\n      root.df += 1;\r\n    } else {\r\n      // if this doc already exist, then update tokenInfo\r\n      root.docs[docRef] = {tf: tokenInfo.tf};\r\n    }\r\n  }\r\n\r\n  hasToken(token) {\r\n    if (!token) return false;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return false;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  getNode(token) {\r\n    if (!token) return null;\r\n\r\n    var node = this.root;\r\n\r\n    for (var i = 0; i < token.length; i++) {\r\n      if (!node[token[i]]) return null;\r\n      node = node[token[i]];\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  getDocs(token) {\r\n    var node = this.getNode(token);\r\n    if (node == null) {\r\n      return {};\r\n    }\r\n\r\n    return node.docs;\r\n  }\r\n\r\n  getTermFrequency(token, docRef) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    if (!(docRef in node.docs)) {\r\n      return 0;\r\n    }\r\n\r\n    return node.docs[docRef].tf;\r\n  }\r\n\r\n  getDocFreq(token) {\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) {\r\n      return 0;\r\n    }\r\n\r\n    return node.df;\r\n  }\r\n\r\n  removeToken(token, ref) {\r\n    if (!token) return;\r\n    var node = this.getNode(token);\r\n\r\n    if (node == null) return;\r\n\r\n    if (ref in node.docs) {\r\n      delete node.docs[ref];\r\n      node.df -= 1;\r\n    }\r\n  }\r\n\r\n  expandToken(token, memo, root) {\r\n    if (token == null || token === '') return [];\r\n    memo = memo || [];\r\n\r\n    if (root == null) {\r\n      root = this.getNode(token);\r\n      if (root == null) return memo;\r\n    }\r\n\r\n    if (root.df > 0) memo.push(token);\r\n\r\n    for (var key in root) {\r\n      if (key === 'docs') continue;\r\n      if (key === 'df') continue;\r\n      this.expandToken(token + key, memo, root[key]);\r\n    }\r\n\r\n    return memo;\r\n  }\r\n\r\n}\r\n","import {Index} from './index.js';\r\nimport {Trimmer} from './trimmer.js';\r\nimport {StopWordFilter} from './stop_word_filters.js';\r\nimport {Stemmer} from './stemmer.js';\r\n\r\nexport function init(config) {\r\n  var index = new Index();\r\n\r\n  index.pipeline.add(\r\n    Trimmer.trim,\r\n    StopWordFilter.filter,\r\n    Stemmer.stem\r\n  );\r\n\r\n  if (config) config.call(index, index);\r\n\r\n  return index;\r\n}\r\n\r\nexport * from './configuration.js';\r\nexport * from './document_store.js';\r\nexport * from './event_emitter.js';\r\nexport * from './index.js';\r\nexport * from './inverted_index.js';\r\nexport * from './pipeline.js';\r\nexport * from './stemmer.js';\r\nexport * from './stop_word_filters.js';\r\nexport * from './tokenizer.js';\r\nexport * from './trimmer.js';\r\nexport * from './utils.js';\r\n","export class Pipeline {\r\n\r\n  constructor() {\r\n    this._queue = [];\r\n  }\r\n\r\n  get() {\r\n    return this._queue;\r\n  }\r\n\r\n  add() {\r\n    var fs = Array.prototype.slice.call(arguments);\r\n\r\n    fs.forEach(function (f) {\r\n      this._queue.push(f);\r\n    }, this);\r\n  }\r\n\r\n  after(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos + 1, 0, newFct);\r\n  };\r\n\r\n  before(existingFct, newFct) {\r\n    var pos = this._queue.indexOf(existingFct);\r\n    if (pos === -1) throw new Error('Cannot find the the requested function to insert after');\r\n\r\n    this._queue.splice(pos, 0, newFct);\r\n  };\r\n\r\n  remove(f) {\r\n    var pos = this._queue.indexOf(f);\r\n    if (pos === -1) return;\r\n\r\n    this._queue.splice(pos, 1);\r\n  };\r\n\r\n  pop() {\r\n    this._queue.pop();\r\n  }\r\n\r\n  clear() {\r\n    this._queue = [];\r\n  }\r\n\r\n  run(tokens) {\r\n    var out = tokens,\r\n      queueLength = this._queue.length;\r\n    for (var i = 0; i < queueLength; i++) {\r\n      var pipelineOutput = [];\r\n      for (let j = 0; j < out.length; j++) {\r\n        var output = this._queue[i](out[j], j, out);\r\n        if (!Array.isArray(output)) output = [output];\r\n        for (var k = 0; k < output.length; k++) {\r\n          if (output[k] !== null && output[k] !== void 0) {\r\n            pipelineOutput.push(output[k]);\r\n          }\r\n        }\r\n      }\r\n      for (var j = pipelineOutput.length - 1; j >= 0; j--) {\r\n        if (pipelineOutput[j] === \"\") pipelineOutput.splice(j, 1);\r\n      }\r\n      out = pipelineOutput;\r\n    }\r\n\r\n    return out;\r\n  }\r\n}\r\n","/* eslint camelcase: 0 */\r\n/* eslint max-len: 0 */\r\n/* eslint brace-style: 0 */\r\n\r\nexport class Stemmer {\r\n\r\n  static stem(word) {\r\n    var step2list = {\r\n        \"ational\": \"ate\",\r\n        \"tional\": \"tion\",\r\n        \"enci\": \"ence\",\r\n        \"anci\": \"ance\",\r\n        \"izer\": \"ize\",\r\n        \"bli\": \"ble\",\r\n        \"alli\": \"al\",\r\n        \"entli\": \"ent\",\r\n        \"eli\": \"e\",\r\n        \"ousli\": \"ous\",\r\n        \"ization\": \"ize\",\r\n        \"ation\": \"ate\",\r\n        \"ator\": \"ate\",\r\n        \"alism\": \"al\",\r\n        \"iveness\": \"ive\",\r\n        \"fulness\": \"ful\",\r\n        \"ousness\": \"ous\",\r\n        \"aliti\": \"al\",\r\n        \"iviti\": \"ive\",\r\n        \"biliti\": \"ble\",\r\n        \"logi\": \"log\"\r\n      },\r\n\r\n      step3list = {\r\n        \"icate\": \"ic\",\r\n        \"ative\": \"\",\r\n        \"alize\": \"al\",\r\n        \"iciti\": \"ic\",\r\n        \"ical\": \"ic\",\r\n        \"ful\": \"\",\r\n        \"ness\": \"\"\r\n      },\r\n\r\n      c = \"[^aeiou]\", // consonant\r\n      v = \"[aeiouy]\", // vowel\r\n      C = c + \"[^aeiouy]*\", // consonant sequence\r\n      V = v + \"[aeiou]*\", // vowel sequence\r\n\r\n      mgr0 = \"^(\" + C + \")?\" + V + C, // [C]VC... is m>0\r\n      meq1 = \"^(\" + C + \")?\" + V + C + \"(\" + V + \")?$\", // [C]VC[V] is m=1\r\n      mgr1 = \"^(\" + C + \")?\" + V + C + V + C, // [C]VCVC... is m>1\r\n      s_v = \"^(\" + C + \")?\" + v; // vowel in stem\r\n\r\n    var re_mgr0 = new RegExp(mgr0);\r\n    var re_mgr1 = new RegExp(mgr1);\r\n    var re_meq1 = new RegExp(meq1);\r\n    var re_s_v = new RegExp(s_v);\r\n\r\n    var re_1a = /^(.+?)(ss|i)es$/;\r\n    var re2_1a = /^(.+?)([^s])s$/;\r\n    var re_1b = /^(.+?)eed$/;\r\n    var re2_1b = /^(.+?)(ed|ing)$/;\r\n    var re_1b_2 = /.$/;\r\n    var re2_1b_2 = /(at|bl|iz)$/;\r\n    var re3_1b_2 = new RegExp(\"([^aeiouylsz])\\\\1$\");\r\n    var re4_1b_2 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    var re_1c = /^(.+?[^aeiou])y$/;\r\n    var re_2 = /^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;\r\n\r\n    var re_3 = /^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;\r\n\r\n    var re_4 = /^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;\r\n    var re2_4 = /^(.+?)(s|t)(ion)$/;\r\n\r\n    var re_5 = /^(.+?)e$/;\r\n    var re_5_1 = /ll$/;\r\n    var re3_5 = new RegExp(\"^\" + C + v + \"[^aeiouwxy]$\");\r\n\r\n    function porterStemmer(w) {\r\n      var stem,\r\n        suffix,\r\n        firstch,\r\n        re,\r\n        re2,\r\n        re3,\r\n        re4,\r\n        fp;\r\n\r\n      if (w.length < 3) { return w; }\r\n\r\n      firstch = w.substr(0, 1);\r\n      if (firstch === \"y\") {\r\n        w = firstch.toUpperCase() + w.substr(1);\r\n      }\r\n\r\n      // Step 1a\r\n      re = re_1a;\r\n      re2 = re2_1a;\r\n\r\n      if (re.test(w)) {w = w.replace(re, \"$1$2\");}\r\n      else if (re2.test(w)) {w = w.replace(re2, \"$1$2\");}\r\n\r\n      // Step 1b\r\n      re = re_1b;\r\n      re2 = re2_1b;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        re = re_mgr0;\r\n        if (re.test(fp[1])) {\r\n          re = re_1b_2;\r\n          w = w.replace(re, \"\");\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1];\r\n        re2 = re_s_v;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n          re2 = re2_1b_2;\r\n          re3 = re3_1b_2;\r\n          re4 = re4_1b_2;\r\n          if (re2.test(w)) { w = w + \"e\"; }\r\n          else if (re3.test(w)) { re = re_1b_2; w = w.replace(re, \"\"); }\r\n          else if (re4.test(w)) { w = w + \"e\"; }\r\n        }\r\n      }\r\n\r\n      // Step 1c - replace suffix y or Y by i if preceded by a non-vowel which is\r\n      // not the first letter of the word (so cry -> cri, by -> by, say -> say)\r\n      re = re_1c;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        w = stem + \"i\";\r\n      }\r\n\r\n      // Step 2\r\n      re = re_2;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step2list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 3\r\n      re = re_3;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        suffix = fp[2];\r\n        re = re_mgr0;\r\n        if (re.test(stem)) {\r\n          w = stem + step3list[suffix];\r\n        }\r\n      }\r\n\r\n      // Step 4\r\n      re = re_4;\r\n      re2 = re2_4;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        if (re.test(stem)) {\r\n          w = stem;\r\n        }\r\n      } else if (re2.test(w)) {\r\n        fp = re2.exec(w);\r\n        stem = fp[1] + fp[2];\r\n        re2 = re_mgr1;\r\n        if (re2.test(stem)) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      // Step 5\r\n      re = re_5;\r\n      if (re.test(w)) {\r\n        fp = re.exec(w);\r\n        stem = fp[1];\r\n        re = re_mgr1;\r\n        re2 = re_meq1;\r\n        re3 = re3_5;\r\n        if (re.test(stem) || (re2.test(stem) && !(re3.test(stem)))) {\r\n          w = stem;\r\n        }\r\n      }\r\n\r\n      re = re_5_1;\r\n      re2 = re_mgr1;\r\n      if (re.test(w) && re2.test(w)) {\r\n        re = re_1b_2;\r\n        w = w.replace(re, \"\");\r\n      }\r\n\r\n      // and turn initial Y back to y\r\n\r\n      if (firstch === \"y\") {\r\n        w = firstch.toLowerCase() + w.substr(1);\r\n      }\r\n\r\n      return w;\r\n    };\r\n\r\n    return porterStemmer(word);\r\n  }\r\n}\r\n","export class StopWordFilter {\r\n\r\n  static filter(token) {\r\n    if (token && StopWordFilter.stopWords[token] !== true) {\r\n      return token;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  static clearStopWords() {\r\n    StopWordFilter.stopWords = {};\r\n  }\r\n\r\n  static addStopWords(words) {\r\n    if (words == null || Array.isArray(words) === false) return;\r\n\r\n    words.forEach(function (word) {\r\n      StopWordFilter.stopWords[word] = true;\r\n    }, this);\r\n  }\r\n\r\n  static resetStopWords() {\r\n    StopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n  }\r\n}\r\n\r\nStopWordFilter.defaultStopWords = {\r\n  \"\": true,\r\n  \"a\": true,\r\n  \"able\": true,\r\n  \"about\": true,\r\n  \"across\": true,\r\n  \"after\": true,\r\n  \"all\": true,\r\n  \"almost\": true,\r\n  \"also\": true,\r\n  \"am\": true,\r\n  \"among\": true,\r\n  \"an\": true,\r\n  \"and\": true,\r\n  \"any\": true,\r\n  \"are\": true,\r\n  \"as\": true,\r\n  \"at\": true,\r\n  \"be\": true,\r\n  \"because\": true,\r\n  \"been\": true,\r\n  \"but\": true,\r\n  \"by\": true,\r\n  \"can\": true,\r\n  \"cannot\": true,\r\n  \"could\": true,\r\n  \"dear\": true,\r\n  \"did\": true,\r\n  \"do\": true,\r\n  \"does\": true,\r\n  \"either\": true,\r\n  \"else\": true,\r\n  \"ever\": true,\r\n  \"every\": true,\r\n  \"for\": true,\r\n  \"from\": true,\r\n  \"get\": true,\r\n  \"got\": true,\r\n  \"had\": true,\r\n  \"has\": true,\r\n  \"have\": true,\r\n  \"he\": true,\r\n  \"her\": true,\r\n  \"hers\": true,\r\n  \"him\": true,\r\n  \"his\": true,\r\n  \"how\": true,\r\n  \"however\": true,\r\n  \"i\": true,\r\n  \"if\": true,\r\n  \"in\": true,\r\n  \"into\": true,\r\n  \"is\": true,\r\n  \"it\": true,\r\n  \"its\": true,\r\n  \"just\": true,\r\n  \"least\": true,\r\n  \"let\": true,\r\n  \"like\": true,\r\n  \"likely\": true,\r\n  \"may\": true,\r\n  \"me\": true,\r\n  \"might\": true,\r\n  \"most\": true,\r\n  \"must\": true,\r\n  \"my\": true,\r\n  \"neither\": true,\r\n  \"no\": true,\r\n  \"nor\": true,\r\n  \"not\": true,\r\n  \"of\": true,\r\n  \"off\": true,\r\n  \"often\": true,\r\n  \"on\": true,\r\n  \"only\": true,\r\n  \"or\": true,\r\n  \"other\": true,\r\n  \"our\": true,\r\n  \"own\": true,\r\n  \"rather\": true,\r\n  \"said\": true,\r\n  \"say\": true,\r\n  \"says\": true,\r\n  \"she\": true,\r\n  \"should\": true,\r\n  \"since\": true,\r\n  \"so\": true,\r\n  \"some\": true,\r\n  \"than\": true,\r\n  \"that\": true,\r\n  \"the\": true,\r\n  \"their\": true,\r\n  \"them\": true,\r\n  \"then\": true,\r\n  \"there\": true,\r\n  \"these\": true,\r\n  \"they\": true,\r\n  \"this\": true,\r\n  \"tis\": true,\r\n  \"to\": true,\r\n  \"too\": true,\r\n  \"twas\": true,\r\n  \"us\": true,\r\n  \"wants\": true,\r\n  \"was\": true,\r\n  \"we\": true,\r\n  \"were\": true,\r\n  \"what\": true,\r\n  \"when\": true,\r\n  \"where\": true,\r\n  \"which\": true,\r\n  \"while\": true,\r\n  \"who\": true,\r\n  \"whom\": true,\r\n  \"why\": true,\r\n  \"will\": true,\r\n  \"with\": true,\r\n  \"would\": true,\r\n  \"yet\": true,\r\n  \"you\": true,\r\n  \"your\": true\r\n};\r\n\r\nStopWordFilter.stopWords = StopWordFilter.defaultStopWords;\r\n","import {toString} from './utils.js';\r\n\r\nexport class Tokenizer {\r\n\r\n  static tokenize(str) {\r\n    if (!arguments.length || str === null || str === undefined) return [];\r\n    if (Array.isArray(str)) {\r\n      var arr = str.filter(function (token) {\r\n        if (token === null || token === undefined) {\r\n          return false;\r\n        }\r\n\r\n        return true;\r\n      });\r\n\r\n      arr = arr.map(function (t) {\r\n        return toString(t).toLowerCase();\r\n      });\r\n\r\n      var out = [];\r\n      arr.forEach(function (item) {\r\n        var tokens = item.split(Tokenizer.separator);\r\n        out = out.concat(tokens);\r\n      }, this);\r\n\r\n      return out;\r\n    }\r\n\r\n    return str.toString().trim().toLowerCase().split(Tokenizer.separator);\r\n  }\r\n\r\n  static getSeparator() {\r\n    return Tokenizer.separator;\r\n  }\r\n\r\n  static setSeparator(sep) {\r\n    Tokenizer.separator = sep;\r\n  }\r\n\r\n  static resetSeparator() {\r\n    Tokenizer.separator = Tokenizer.defaultSeparator;\r\n  }\r\n\r\n}\r\n\r\nTokenizer.defaultSeparator = /[\\s\\-]+/;\r\nTokenizer.separator = Tokenizer.defaultSeparator;\r\n","export class Trimmer {\r\n\r\n  static trim(token) {\r\n    if (token === null || token === undefined) {\r\n      throw new Error('token should not be undefined');\r\n    }\r\n\r\n    return token\r\n      .replace(/^\\W+/, '')\r\n      .replace(/\\W+$/, '');\r\n  }\r\n}\r\n","export function warn(global) {\r\n  return function (message) {\r\n    if (global.console && console.warn) {\r\n      console.warn(message);\r\n    }\r\n  };\r\n}\r\n\r\nexport function toString(obj) {\r\n  if (obj === undefined || obj === null) return \"\";\r\n\r\n  return obj.toString();\r\n}\r\n\r\nexport function clone(obj) {\r\n  if (obj === null || typeof obj !== \"object\") return obj;\r\n  var copy = obj.constructor();\r\n\r\n  for (var attr in obj) {\r\n    if (obj.hasOwnProperty(attr)) copy[attr] = obj[attr];\r\n  }\r\n  return copy;\r\n}\r\n"],"sourceRoot":""}